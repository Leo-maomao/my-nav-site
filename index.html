<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>毛毛的导航站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- 引入 Remix Icon 图标库 -->
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    :root {
      --bg: #f5f7fb;
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-sub: #6b7280;
      --text-muted: #9ca3af;  
      --accent: #2563eb;
      --border-subtle: #e5e7eb;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.12);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui,
        -system-ui, "PingFang SC", "Noto Sans SC", "Microsoft YaHei", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .layout {
      display: flex;
      min-height: 100vh;
      align-items: flex-start; /* Revert to top alignment */
    }

    /* 左侧侧边栏 */

    .sidebar {
      width: 230px;
      background: #ffffff;
      border-right: 1px solid rgba(229, 231, 235, 0.9);
      display: flex;
      flex-direction: column;
      padding: 24px 16px;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      /* Hide scrollbar but allow scrolling */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none;  /* IE 10+ */
    }
    .sidebar::-webkit-scrollbar {
      display: none; /* Chrome/Safari/Webkit */
    }

    .side-logo {
      font-size: 22px; /* 稍微调小一点，适配侧边栏宽度 */
      font-weight: 800;
      margin-bottom: 24px;
      letter-spacing: -0.5px;
      background: linear-gradient(to right, #2563eb, #9333ea);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      justify-content: center; /* 确保居中 */
      gap: 8px;
      width: 100%; /* 占满宽度 */
    }

    .side-logo i {
       font-size: 24px;
       color: #2563eb;
       -webkit-text-fill-color: #2563eb; /* 图标保持原色，不随文字渐变 */
       background: none;
    }

    /* 移除之前的伪元素竖条 */
    .side-logo::before {
       display: none;
    }

    .side-avatar {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px 8px;
      border: 1px solid rgba(229, 231, 235, 0.6);
      background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 16px;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.03);
    }

    .side-avatar-top {
       display: flex;
       flex-direction: column;
       align-items: center;
       gap: 10px;
       width: 100%;
       text-align: center;
    }

      /* 侧边栏头像调整：移除头像，精简布局 */
    .side-avatar-circle {
      display: none; /* Hide avatar as requested */
    }
    .side-avatar-top {
       gap: 4px; /* Reduce gap */
       margin-top: 4px; /* Add slight top margin */
    }
    .side-logo {
      font-size: 20px; /* Reduce logo size */
      margin-bottom: 16px;
    }
    .side-avatar {
      padding: 14px 8px; /* Balanced padding (Top/Bottom) */
      gap: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center; /* Center vertically */
    }
    
    .side-social-links {
       margin-top: 0; /* Remove top margin to rely on parent gap */
       margin-bottom: 4px; /* Add slight bottom margin to balance */
    }
    
    /* 修复添加工具卡片拉长问题 */
    .tool-card {
      min-height: 88px; /* 统一卡片最小高度 */
      justify-content: center; /* 内容居中 */
    }
    .tool-card-add {
      min-height: 88px; /* 保持一致 */
      height: 100%; /* 撑满单元格 */
      box-sizing: border-box;
    }

    .side-avatar-info {
      display: flex;
      flex-direction: column;
      gap: 2px;
      align-items: center;
    }

    .side-avatar-name {
       font-size: 16px;
       font-weight: 700;
       color: #111827;
    }

    .side-avatar-desc {
       font-size: 14px;
       color: #334155;
       /* 纯色，去除背景 */
       background: transparent;
       padding: 0;
       font-weight: 500;
       margin-top: 6px;
    }

    .side-social-links {
       display: grid;
       grid-template-columns: 1fr 1fr;
       gap: 10px;
       width: 100%;
       margin-top: 4px;
       margin-bottom: 6px; /* Add margin bottom to match slogan top spacing */
    }

    /* 单独调整右侧 Github 按钮的位置 */
    .side-social-item:last-child {
        transform: translateX(-4px);
    }
    
    /* Hover 效果时需要保留位移 */
    .side-social-item:last-child:hover {
        transform: translateX(-2px); /* -4px + 2px hover effect = -2px */
    }

    .side-social-item {
       display: flex;
       align-items: center;
       justify-content: center;
       gap: 6px;
       height: 32px; /* Reduced height from 38px */
       border-radius: 10px;
       background: #f8fafc; /* 默认背景 */
       border: 1px solid transparent;
       font-size: 13px;
       color: #4b5563;
       text-decoration: none;
       transition: all 0.2s ease;
       font-weight: 500;
    }
    
    /* Hover 效果与下方分组保持一致 */
    .side-social-item:hover {
      background: #eff6ff;
      color: #2563eb;
      border-color: rgba(37, 99, 235, 0.1);
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.05);
    }
    
    .side-social-item svg {
        display: none; /* 隐藏可能残留的 svg */
    }

    .side-social-item i {
        font-size: 16px;
        color: inherit;
    }

    .side-section-title {
      font-size: 12px;
      color: var(--text-muted);
      margin: 14px 4px 8px;
    }

    .side-menu {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 15px; /* 稍微调小一点，避免太拥挤 */
      display: flex;
      flex-direction: column;
      gap: 6px; /* 减小间距，确保一屏放下 */
    }

    .side-menu li {
      padding: 12px 16px; /* 适度减小内边距 */
      border-radius: 10px;
      color: #4b5563;
      font-weight: 600;
      transition: all 0.2s ease;
      border: 1px solid rgba(229, 231, 235, 0.5);
      background: linear-gradient(to right, #f8fafc, #f1f5f9);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .side-menu li:hover {
      /* 悬浮时颜色更丰富，类似果冻质感 */
      background: linear-gradient(to right, #eff6ff, #dbeafe);
      color: #2563eb;
      border-color: rgba(37, 99, 235, 0.2);
      transform: translateX(4px) scale(1.02); /* 增加一点缩放 */
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
      cursor: pointer;
    }
    
    /* 移除 a 标签的默认样式影响，确保点击区域 */
    .side-menu li {
        cursor: pointer;
    }
    
    /* 菜单项内部布局 */
    .side-menu-inner {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
    }
    
    /* 菜单项图标 */
    .side-menu-inner i {
       font-size: 18px;
       color: #64748b;
       transition: color 0.2s ease;
    }
    
    .side-menu li:hover .side-menu-inner i {
       color: #2563eb;
    }
    
    /* 右侧小箭头 */
    .side-menu-arrow {
        font-size: 14px;
        color: #94a3b8;
        opacity: 0;
        transition: all 0.2s ease;
        transform: translateX(-4px);
    }
    
    .side-menu li:hover .side-menu-arrow {
        opacity: 1;
        transform: translateX(0);
        color: #2563eb;
    }

    /* 侧边栏底部 Footer (Config & Admin Feedback) */
    .side-footer {
        margin-top: auto; /* Push to bottom */
        padding-top: 16px;
        border-top: 1px dashed #e2e8f0;
        display: none; /* Hidden by default, shown by JS if admin */
        gap: 10px;
        justify-content: space-evenly;
    }

    .side-footer-btn {
        flex: 1;
        height: 36px;
        border-radius: 8px;
        background: #f8fafc;
        border: 1px solid transparent;
        color: #64748b;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.2s;
    }
    .side-footer-btn:hover {
        background: #eff6ff;
        color: #2563eb;
        border-color: rgba(37, 99, 235, 0.1);
        transform: translateY(-2px);
    }
    .side-footer-btn.is-active {
        background: #2563eb;
        color: #ffffff;
    }

    /* 右侧主区域 */

    .main {
      flex: 1;
      padding: 12px 18px 24px;
      /* 使用整个页面滚动，避免右侧单独滚动导致选中状态不同步 */
      overflow: visible;
    }

    .top-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 18px;
      margin-bottom: 24px;
    }

    /* 通用卡片容器样式 */
    .nav-card-common {
      position: relative;
      border-radius: 18px;
      padding: 16px 20px;
      height: 170px;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      color: #ffffff;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background-size: cover;
      background-position: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .nav-card-common:hover {
      transform: translateY(-4px);
      box-shadow: 0 15px 35px -10px rgba(0, 0, 0, 0.25);
    }

    /* 卡片遮罩，保证文字清晰 */
    .nav-card-common::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.35); /* 统一使用较深的遮罩 */
      z-index: 1;
      transition: background 0.3s ease;
    }

    .nav-card-common:hover::before {
      background: rgba(0, 0, 0, 0.25);
    }

    .nav-card-content {
      position: relative;
      z-index: 2;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    /* 3. 集成式 Hero Dashboard - 极简浅色风格 */
    .hero-dashboard {
      background: #ffffff;
      border-radius: 24px;
      padding: 24px 32px;
      color: #1e293b;
      margin-bottom: 24px;
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(0,0,0,0.03);
      position: relative;
      overflow: hidden;
    }

    /* 装饰性背景光 - 更淡雅 */
    .hero-bg-decor {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }
    .hero-bg-decor::before {
      content: "";
      position: absolute;
      top: -30%;
      left: -10%;
      width: 60%;
      height: 120%;
      background: radial-gradient(circle, rgba(236, 242, 255, 0.8) 0%, transparent 70%);
      filter: blur(50px);
    }
    .hero-bg-decor::after {
      content: "";
      position: absolute;
      bottom: -20%;
      right: -10%;
      width: 60%;
      height: 100%;
      background: radial-gradient(circle, rgba(240, 253, 250, 0.8) 0%, transparent 70%);
      filter: blur(50px);
    }

    .hero-content {
      position: relative;
      z-index: 2;
      display: flex;
      align-items: stretch; /* Stretch to match height */
      justify-content: center;
      gap: 24px; /* Reduced from 56px */
    }

    /* Hero Banner Style */
    .hero-banner {
      flex: 1;
      min-width: 0; 
      background: #f8fafc;
      border-radius: 16px;
      overflow: hidden;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      border: 1px solid #e2e8f0;
      display: flex;
      flex-direction: column;
      /* 核心修改：使用 aspect-ratio 保持比例，防止在小屏下折叠 */
      width: 100%;
      height: auto;
      aspect-ratio: 16 / 9;
      /* 兜底背景：当图片加载失败或空白时显示 */
      background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
    }
    
    /* 针对更宽屏幕的优化，避免太高 */
    @media (min-width: 1200px) {
      .hero-banner {
        aspect-ratio: 2.5 / 1; /* 宽屏下更扁一点，节省垂直空间 */
      }
    }
    
    .banner-wrapper {
      position: relative;
      width: 100%;
      height: 100%;
      /* 移除 min-height，完全靠 aspect-ratio 撑开 */
    }

    .banner-slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      z-index: 1;
      cursor: pointer;
    }
    .banner-slide.active {
      opacity: 1;
      z-index: 2;
    }
    
    .banner-content {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      padding: 16px 20px;
      background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
      color: #fff;
      z-index: 3;
      pointer-events: none;
    }
    
    .banner-tag {
      display: inline-block;
      padding: 3px 6px;
      background: #2563eb;
      color: #fff;
      font-size: 10px;
      font-weight: 600;
      border-radius: 4px;
      margin-bottom: 6px;
      text-transform: uppercase;
    }
    
    /* Banner 响应式修正：防止文字在小屏下折叠 */
    .banner-title {
      font-size: 15px;
      font-weight: 600;
      line-height: 1.4;
      margin: 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2; /* Standard property for compatibility */
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    /* 针对小屏幕，适当缩小字号 */
    @media (max-width: 768px) {
      /* 核心修复：防止 Sidebar 被压缩 */
      .sidebar {
         flex-shrink: 0;
      }

      /* Mobile View Enhancements */
      .banner-title {
        font-size: 14px;
        -webkit-line-clamp: 2; /* 保持两行 */
      }
      /* 增加蒙层浓度，确保文字清晰 */
      .banner-content {
        background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.5) 70%, transparent 100%);
      }
    }
    
    .banner-indicators {
      position: absolute;
      bottom: 12px;
      right: 16px;
      display: flex;
      gap: 6px;
      z-index: 4;
    }
    
    .banner-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(255,255,255,0.4);
      cursor: pointer;
      transition: all 0.3s;
    }
    .banner-dot.active {
      background: #fff;
      width: 16px;
      border-radius: 999px;
    }

    .banner-loading {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8fafc;
      color: #94a3b8;
      font-size: 13px;
      z-index: 0;
    }

    /* 左侧：时间大卡片 */
    .hero-left {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 24px;
      flex: 0 0 auto; /* Don't shrink */
      padding: 0 16px;
    }
    
    /* 翻页时钟样式 */
    .flip-clock {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .flip-unit {
      position: relative;
      width: 72px;
      height: 96px;
      background: #334155;
      border-radius: 12px;
      font-size: 56px;
      font-weight: 700;
      line-height: 96px;
      text-align: center;
      color: #f8fafc;
      font-family: 'SF Mono', 'Menlo', monospace;
      perspective: 300px;
      box-shadow: 0 8px 16px rgba(51, 65, 85, 0.25);
      overflow: hidden;
    }

    .flip-top,
    .flip-bottom {
      position: absolute;
      left: 0;
      width: 100%;
      height: 50%;
      overflow: hidden;
      background: #334155;
      color: #f8fafc;
      box-sizing: border-box;
      backface-visibility: hidden;
    }

    .flip-top {
      top: 0;
      border-radius: 12px 12px 0 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.25);
      line-height: 96px;
      transform-origin: 50% 100%;
    }

    .flip-bottom {
      bottom: 0;
      border-radius: 0 0 12px 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      line-height: 0;
      transform-origin: 50% 0%;
    }

    .flip-divider-dots {
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding: 0 4px;
    }

    .flip-divider-dots span {
      width: 6px;
      height: 6px;
      background: #cbd5e1;
      border-radius: 999px;
    }

    .hero-date-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .hero-date-pill {
      background: rgba(248, 250, 252, 0.9);
      padding: 6px 18px;
      border-radius: 999px;
      font-size: 16px;
      color: #0f172a;
      font-family: 'SF Mono', 'Menlo', monospace;
      letter-spacing: 2px;
      font-weight: 600;
      box-shadow: 0 6px 16px rgba(148, 163, 184, 0.18);
    }

    .hero-date-pill-sub {
      background: rgba(248, 250, 252, 0.9);
      border-radius: 999px;
      font-size: 14px;
      color: #64748b;
      letter-spacing: 1px;
      box-shadow: 0 4px 10px rgba(148, 163, 184, 0.15);
    }

    /* 右侧：天气与访客 */
    .hero-right {
      flex: 0 0 580px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    
    .hero-right-row {
      display: flex;
      gap: 18px;
      align-items: stretch;
    }
    
    /* 天气卡片 */
    .weather-block {
      flex: 2.4;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 14px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 18px 20px 16px;
      transition: all 0.2s ease;
      min-height: 180px;
    }
    .weather-block:hover {
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
      border-color: #cbd5e1;
    }

    .weather-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    
    .weather-info-main {
      display: flex;
      align-items: center;
      gap: 14px;
    }
    .weather-icon-big {
      font-size: 36px;
      background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 4px rgba(245, 158, 11, 0.2));
    }
    .weather-text-group {
      display: flex;
      flex-direction: column;
    }
    .weather-temp-val {
      font-size: 26px;
      font-weight: 700;
      line-height: 1.1;
      color: #1e293b;
    }
    .weather-desc-val {
      font-size: 13px;
      color: #64748b;
      margin-top: 2px;
    }
    .weather-loc-badge {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: #64748b;
      background: #f1f5f9;
      padding: 6px 12px;
      border-radius: 999px;
      white-space: nowrap;
    }
    
    /* 7 天折线预报（参考 iOS 天气） */
    .weather-forecast {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px dashed #e2e8f0;
    }
    
    .weather-forecast-top {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 4px;
      min-height: 14px; /* 占一点空间，避免布局跳动 */
    }
    
    .weather-forecast-title {
      font-weight: 500;
      color: #475569;
    }
    
    /* 行：日期 / 图标 / 数字 统一样式（严格 5 等分，和折线使用同一套列中心） */
    .weather-forecast-row {
      display: grid;
      grid-template-columns: repeat(var(--weather-days, 5), 1fr);
      align-items: center;
      margin-bottom: 2px;
    }
    
    .weather-forecast-labels {
      display: grid;
      grid-template-columns: repeat(var(--weather-days, 5), 1fr);
      font-size: 11px;
      color: #94a3b8;
      margin-bottom: 2px;
    }
    
    .weather-forecast-labels span,
    .weather-forecast-row span {
      text-align: center;
      white-space: nowrap;
    }
    
    .weather-forecast-icons i {
      font-size: 16px;
    }
    
    .weather-forecast-icons-high i {
      color: #f97316;
    }
    
    .weather-forecast-icons-low i {
      color: #3b82f6;
      opacity: 0.85;
    }
    
    .weather-forecast-temps {
      font-size: 11px;
      color: #475569;
    }
    
    .weather-forecast-temps-high span {
      font-weight: 600;
      color: #ea580c;
    }
    
    .weather-forecast-temps-low span {
      color: #2563eb;
    }
    
    .weather-forecast-chart-wrap {
      width: 100%;
      height: 90px; /* 固定高度，确保不塌缩 */
      margin: 4px 0;
    }
    
    .weather-chart-svg {
      width: 100%;
      height: 100%;
      display: block;
      overflow: visible;
    }
    
    .weather-chart-svg polyline {
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    
    .weather-chart-dot {
      stroke: #eff6ff;
      stroke-width: 0.6;
    }

    /* 访客独立卡片 */
    .visitor-card {
      flex: 1.2;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 18px 18px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 10px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.04);
      min-height: 180px;
    }

    .visitor-card:hover {
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
      border-color: #cbd5e1;
    }

    .visitor-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      color: #64748b;
    }

    .visitor-card-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      color: #0f172a;
    }

    .visitor-card-title i {
      font-size: 16px;
      color: #2563eb;
    }

    .visitor-card-body {
      display: flex;
      flex-direction: column;
      gap: 8px;
      flex: 1;
      justify-content: center;
    }

    .visitor-metric {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
    }

    .visitor-metric-label {
      font-size: 12px;
      color: #6b7280;
    }

    .visitor-metric-value {
      font-size: 22px;
      font-weight: 700;
      color: #111827;
      font-family: 'SF Mono', 'Menlo', monospace;
    }

    .visitor-card-footer {
      margin-top: 4px;
      padding-top: 10px;
      border-top: 1px dashed #e2e8f0;
      font-size: 11px;
      color: #9ca3af;
    }

    .visitor-trend {
      font-size: 12px;
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 2px;
      font-weight: 500;
    }
    
    .weather-footer {
      display: none; /* hidden, moved to header */
    }
    
    .weather-update-time {
      white-space: nowrap;
    }

    /* 访客区块 */
    .stats-block {
      flex: 1;
      display: flex;
      gap: 14px;
    }
    .stats-item {
      flex: 1;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 14px 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      transition: all 0.2s ease;
    }
    .stats-item:hover {
      background: #ffffff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
      border-color: #cbd5e1;
    }
    
    .stats-title {
      font-size: 12px;
      color: #64748b;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .stats-num {
      font-size: 22px;
      font-weight: 700;
      color: #1e293b;
      font-family: 'SF Mono', 'Menlo', monospace;
      letter-spacing: -0.5px;
    }
    .stats-trend {
      font-size: 12px;
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 2px;
    }


    /* 51.la 挂件样式深度定制 */
    #la_data_container {
        display: flex;
        flex-direction: column;
        gap: 8px;
        width: 100%;
        min-height: 100px; /* 给它一个最小高度，确保有地方渲染 */
    }
    
    /* 尝试对 51.la 默认生成的结构进行样式覆盖 */
    /* 51.la v6 挂件通常生成 span 或 div 列表 */
    #la_data_container .la-quote-item, 
    #la_data_container span {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        width: 100% !important;
        font-size: 12px !important;
        color: #6b7280 !important;
        margin: 0 !important;
        padding: 4px 0 !important;
        border-bottom: 1px dashed #f1f5f9;
    }
    
    #la_data_container .la-quote-item:last-child,
    #la_data_container span:last-child {
        border-bottom: none;
    }

    /* 数字加粗 */
    #la_data_container .la-quote-item b,
    #la_data_container span b,
    #la_data_container span strong, 
    #la_data_container span i {
        font-size: 18px !important;
        font-weight: 700 !important;
        color: #111827 !important;
        font-family: 'SF Mono', 'Menlo', monospace !important;
        font-style: normal !important;
    }

    /* 翻页动画关键帧 */
    @keyframes flipTop {
      0% { transform: rotateX(0deg); }
      100% { transform: rotateX(-90deg); }
    }
    @keyframes flipBottom {
      0% { transform: rotateX(90deg); }
      100% { transform: rotateX(0deg); }
    }
    
    /* 静态展示层 */
    .flip-static .flip-top { z-index: 1; }
    .flip-static .flip-bottom { z-index: 1; }

    /* 动画层 */
    .flip-anim-top {
      z-index: 2;
      transform-origin: 50% 100%;
      animation: flipTop 0.6s ease-in both;
    }
    .flip-anim-bottom {
      z-index: 2;
      transform-origin: 50% 0%;
      animation: flipBottom 0.6s ease-out both;
    }

    /* 顶部搜索区域：参考 AI 工具集 */
    .weather-update-time-badge {
      margin-left: 6px;
      padding-left: 6px;
      border-left: 1px solid #cbd5e1;
      font-size: 11px;
      color: #94a3b8;
    }

    /* 配置模式相关样式 */
    /* 移除旧的浮动样式 */
    /* .config-toggle-btn { ... } REMOVED */ 

    /* 默认隐藏编辑控件 */
    .edit-control {
      display: none;
    }
    
    /* 配置模式下显示 */
    body.is-config-mode .edit-control {
      display: flex;
    }

    /* 侧边栏编辑控件 */
    .sidebar-item-actions {
      display: none;
      gap: 4px;
      margin-left: auto;
    }
    body.is-config-mode .side-menu li:hover .sidebar-item-actions,
    body.is-config-mode .sidebar-item-actions {
      display: flex;
    }
    .sidebar-action-btn {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      cursor: pointer;
      color: #94a3b8;
      transition: all 0.2s;
    }
    .sidebar-action-btn:hover {
      background: rgba(0,0,0,0.05);
      color: #334155;
    }
    .sidebar-action-btn.delete:hover {
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }

    /* 侧边栏添加按钮 */
    .sidebar-add-btn {
      display: none;
      margin: 10px 20px;
      padding: 8px;
      border: 1px dashed #cbd5e1;
      border-radius: 8px;
      text-align: center;
      color: #64748b;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    body.is-config-mode .sidebar-add-btn {
      display: block;
    }
    .sidebar-add-btn:hover {
      border-color: #2563eb;
      color: #2563eb;
      background: rgba(37, 99, 235, 0.05);
    }

    /* 工具卡片编辑控件 */
    .tool-card {
      position: relative;
    }
    .tool-card-actions {
      position: absolute;
      top: 6px;
      right: 6px;
      display: none;
      gap: 4px;
      z-index: 10;
    }
    body.is-config-mode .tool-card:hover .tool-card-actions,
    body.is-config-mode .tool-card-actions {
      display: flex;
    }
    .tool-action-btn {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.9);
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #64748b;
      font-size: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .tool-action-btn:hover {
      color: #2563eb;
      border-color: #2563eb;
    }
    .tool-action-btn.delete:hover {
      color: #ef4444;
      border-color: #ef4444;
    }

    /* 添加工具卡片 */
    .tool-card-add {
      display: none;
      border: 1px dashed #cbd5e1;
      border-radius: 12px; /* Match card radius */
      background: transparent;
      align-items: center;
      justify-content: center;
      color: #94a3b8;
      flex-direction: column;
      gap: 8px;
      cursor: pointer;
      min-height: 88px; 
    }
    body.is-config-mode .tool-card-add {
      display: flex;
    }
    .tool-card-add:hover {
      border-color: #2563eb;
      color: #2563eb;
      background: rgba(37, 99, 235, 0.02);
    }

    .search-section {
      margin-top: 10px;
      margin-bottom: 16px;
    }

    .search-section-inner {
      max-width: 960px;
      margin: 0 auto;
    }

    .search-tabs {
      display: flex;
      gap: 18px;
      font-size: 13px;
      margin-bottom: 10px;
      justify-content: center;
    }

    .search-tab {
      padding: 2px 10px 4px;
      cursor: pointer;
      position: relative;
      color: #6b7280;
      font-size: 13px;
    }

    .search-tab.is-active {
      color: #2563eb;
      font-weight: 600;
    }

    .search-tab.is-active::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      bottom: -4px;
      height: 2px;
      border-radius: 999px;
      background: #2563eb;
    }

    .search-main {
      position: relative;
      background: rgba(148, 163, 184, 0.28);
      border-radius: 999px;
      padding: 10px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: #f3f4f6;
      font-size: 13px;
    }

    .search-main-input {
      border: none;
      outline: none;
      background: transparent;
      width: 100%;
      color: #111827;
      font-size: 13px;
    }

    .search-main-input::placeholder {
      color: rgba(55, 65, 81, 0.85);
    }

    .search-main-icon {
      font-size: 18px;
      cursor: pointer;
    }

    .search-main-arrow {
      position: absolute;
      left: 0;
      bottom: -8px;
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid rgba(148, 163, 184, 0.28);
    }

    .search-engines {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin-top: 14px;
      font-size: 13px;
      color: #6b7280;
      flex-wrap: wrap;
    }

    .search-engine-item {
      cursor: pointer;
      padding: 2px 10px;
      border-radius: 999px;
      transition: color 0.12s ease;
      font-size: 13px;
    }

    /* 下方标签不再做明显选中效果，仅内部用来标记当前引擎 */
    .search-engine-item.is-active {
      background: transparent;
      color: inherit;
      font-weight: 500;
    }

    /* 工具分类区（搜索下方按类别整块罗列） */

    .tool-layout {
      margin-top: 18px;
    }

    .tool-tag-icon {
      width: 16px;
      text-align: center;
      flex-shrink: 0;
    }

    .tool-list {
      background: transparent;
    }

    .tool-list-title {
      font-size: 14px;
      font-weight: 600;
      margin: 0;
    }

    .tool-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }

    .tool-section {
      margin-bottom: 26px;
    }

    .tool-section-header {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 10px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #f3f4ff;
      border: 1px solid rgba(209, 213, 219, 0.9);
    }

    .tool-card {
      position: relative;
      border-radius: 10px;
      padding: 8px 10px;
      background: #ffffff;
      border: 1px solid rgba(229, 231, 235, 0.9);
      font-size: 13px;
      cursor: pointer;
      transition: box-shadow 0.12s ease, transform 0.12s ease, border-color 0.12s ease, background 0.12s ease;
      display: flex;
      flex-direction: column;
      gap: 4px;
      height: 100%; /* Ensure card fills grid cell height to prevent whitespace issues */
    }
    
    .tool-card:hover {
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.10);
      transform: translateY(-1px);
      border-color: rgba(148, 163, 184, 0.9);
    }

    .tool-card.tool-card-highlight {
      border-color: #2563eb;
      background: #eff6ff;
      box-shadow: 0 14px 32px rgba(37, 99, 235, 0.35);
      transform: translateY(-3px);
    }

    .tool-card-header {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tool-card-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
      color: #f9fafb;
      font-size: 18px;
      font-weight: 600;
    }

    /* 如果是图片（网站Logo），不需要背景色和渐变 */
    .tool-card-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      pointer-events: none; /* Add this to prevent clicking when hidden */
    }
    .modal-overlay.is-visible {
      opacity: 1;
      visibility: visible;
      pointer-events: auto; /* Enable clicks */
    }
    .modal-box {
      background: #fff;
      border-radius: 16px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      transform: scale(0.95);
      transition: transform 0.2s ease;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      overscroll-behavior: contain; /* Prevent scroll chaining */
    }
    .modal-overlay.is-visible .modal-box {
      transform: scale(1);
    }
    
    .modal-header {
      padding: 16px 24px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      flex-wrap: nowrap;
    }
    .modal-header h3 {
      margin: 0;
      font-size: 16px;
      font-weight: 600;
      color: #1e293b;
      white-space: nowrap;
    }
    .modal-close {
      font-size: 20px;
      color: #94a3b8;
      cursor: pointer;
      transition: color 0.2s;
      margin-left: 10px;
      display: flex;
      align-items: center;
      width: 24px;
      height: 24px;
      justify-content: center;
    }
    .modal-close:hover {
      color: #64748b;
    }

    .modal-body {
      padding: 24px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      overscroll-behavior: contain; /* Prevent scroll chaining */
    }
    
    .modal-input-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .modal-input-group label {
      font-size: 13px;
      font-weight: 500;
      color: #475569;
    }

    .modal-input {
      padding: 8px 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
      width: 100%;
      box-sizing: border-box;
      font-family: inherit;
      resize: vertical;
      overscroll-behavior: contain; /* Prevent scroll chaining */
    }
    .modal-input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
    }
    .modal-footer {
      padding: 16px 24px;
      background: #f8fafc;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    .modal-btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }
    .modal-btn.cancel {
      background: #fff;
      border: 1px solid #e2e8f0;
      color: #64748b;
    }
    .modal-btn.cancel:hover {
      background: #f1f5f9;
      color: #475569;
    }
    .modal-btn.confirm {
      background: #2563eb;
      color: #fff;
      box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
    }
    .modal-btn.confirm:hover {
      background: #1d4ed8;
    }
    .modal-btn.danger {
      background: #ef4444;
      color: #fff;
      box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
    }
    .modal-btn.danger:hover {
      background: #dc2626;
    }
    
    /* 仅当没有图片（回退到首字母）时，才应用背景色，这里通过JS逻辑辅助控制或者CSS选择器 */
    .tool-card-icon.has-fallback {
       background: linear-gradient(135deg, #4f46e5, #6366f1);
    }

    .tool-card-body {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .tool-card-name {
      font-weight: 600;
    }

    .tool-card-desc {
      font-size: 12px;
      color: #6b7280;
    }

    /* hover 提示气泡 - 已禁用 */
    /*
    .tool-card::after {
      content: attr(data-tooltip);
      ...
    }
    .tool-card::before {
      content: "";
      ...
    }
    */


    .tool-card:hover::after,
    .tool-card:hover::before {
      opacity: 1;
    }

    /* 回到顶部按钮 */

    .back-to-top {
      position: fixed;
      right: 22px;
      bottom: 26px;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #2563eb, #6366f1);
      color: #f9fafb;
      cursor: pointer;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.35);
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      z-index: 60;
    }

    .back-to-top.is-visible {
      display: flex;
    }

    /* Custom Scrollbar for modal inputs */
    .modal-input::-webkit-scrollbar {
        width: 6px;
        height: 6px;
    }
    .modal-input::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }
    .modal-input::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }
    .modal-input::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }

    /* Admin Pagination */
    .pagination-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0 0;
      border-top: 1px solid #f1f5f9;
      margin-top: 10px;
    }
    .page-size-select {
      padding: 4px 8px;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      font-size: 12px;
      color: #64748b;
      outline: none;
    }
    .pagination-btns {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .page-btn {
      padding: 4px 10px;
      border: 1px solid #e2e8f0;
      background: #fff;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      color: #64748b;
    }
    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .page-btn:hover:not(:disabled) {
      background: #f8fafc;
      color: #2563eb;
      border-color: #cbd5e1;
    }
    .page-info {
      font-size: 12px;
      color: #94a3b8;
    }

  </style>
</head>
<body>
<div class="layout">
  <!-- 左侧侧边栏 -->
  <aside class="sidebar">
    <div class="side-logo">
      毛毛的导航站
    </div>

    <div class="side-avatar">
      <div class="side-avatar-top">
        <div class="side-avatar-circle">M</div>
        <div class="side-avatar-info">
          <div class="side-avatar-desc">永远相信美好的事即将发生</div>
        </div>
      </div>
      <div class="side-social-links">
         <a href="./blog.html" class="side-social-item" target="_blank">
           <i class="ri-book-2-line"></i> 博客
         </a>
         <a href="https://github.com/Leo-maomao" class="side-social-item" target="_blank" rel="noopener noreferrer">
           <i class="ri-github-line"></i> Github
         </a>
      </div>
    </div>

    <ul class="side-menu" id="sideMenu">
      <!-- JS 渲染分类列表 -->
    </ul>

    <!-- 底部管理员工具栏 (默认隐藏) -->
    <div class="side-footer" id="sideFooter">
        <div class="side-footer-btn" id="configToggleBtn" title="开启/关闭配置模式">
            <i class="ri-settings-3-line"></i>
        </div>
        <div class="side-footer-btn" id="adminFeedbackBtn" title="查看用户反馈" onclick="openAdminFeedback()">
            <i class="ri-message-3-line"></i>
        </div>
    </div>
  </aside>

  <!-- 右侧主区域 -->
  <div class="main">
    <div class="hero-dashboard">
      <div class="hero-bg-decor"></div>
      <div class="hero-content">

        <!-- 轮播图 (New) -->
        <div class="hero-banner">
           <div class="banner-wrapper" id="bannerWrapper">
              <div class="banner-loading">正在获取最新 AI 资讯...</div>
              <div class="banner-indicators" id="bannerIndicators"></div>
           </div>
        </div>
        <!-- 左侧：时间日期 -->
        <div class="hero-left">
          <div class="flip-clock" id="flipClock">
            <div class="flip-unit" id="flipHour">
              <div class="flip-top">00</div>
              <div class="flip-bottom">00</div>
            </div>
            <div class="flip-divider-dots">
              <span></span><span></span>
            </div>
            <div class="flip-unit" id="flipMin">
              <div class="flip-top">00</div>
              <div class="flip-bottom">00</div>
            </div>
            <div class="flip-divider-dots">
              <span></span><span></span>
            </div>
            <div class="flip-unit" id="flipSec">
              <div class="flip-top">00</div>
              <div class="flip-bottom">00</div>
            </div>
          </div>
          
          <div class="hero-date-container">
             <div class="hero-date-pill" id="navDate">0000 年 00 月 00 日</div>
             <div class="hero-date-pill hero-date-pill-sub" id="navExtra">今天 · 周一</div>
          </div>
        </div>

         <!-- 右侧：天气与访客 -->
        <div class="hero-right">
          <div class="hero-right-row">
             <div class="weather-block">
                <div class="weather-header">
                   <div class="weather-info-main">
                      <i id="weatherIcon" class="ri-sun-cloudy-line weather-icon-big"></i>
                      <div class="weather-text-group">
                         <div class="weather-temp-val" id="weatherTemp">--°</div>
                         <div class="weather-desc-val" id="weatherDesc">--</div>
                      </div>
                   </div>
                   <div class="weather-meta-right">
                      <div class="weather-loc-badge">
                         <i class="ri-map-pin-line"></i>
                         <span id="weatherCityName">定位中</span>
                         <span class="weather-update-time-badge" id="weatherUpdateTime">--:-- 更新</span>
                      </div>
                   </div>
                </div>
                <div class="weather-forecast">
                   <div class="weather-forecast-top">
                      <span class="weather-forecast-title" id="weatherForecastTitle"></span>
                   </div>
                   <!-- 1. 日期行：今 / 周几 -->
                   <div class="weather-forecast-labels" id="weatherChartLabels"></div>
                   <!-- 2. 最高温天气图示 -->
                   <div class="weather-forecast-row weather-forecast-icons weather-forecast-icons-high" id="weatherChartIconsHigh"></div>
                   <!-- 3. 最高温数字 -->
                   <div class="weather-forecast-row weather-forecast-temps weather-forecast-temps-high" id="weatherChartTempsHigh"></div>
                   <!-- 4-5. 中间是高/低温折线图 -->
                   <div class="weather-forecast-chart-wrap">
                      <svg id="weatherChart" class="weather-chart-svg" viewBox="0 0 100 40">
                        <defs>
                          <linearGradient id="weatherChartGradient" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="#60a5fa" stop-opacity="0.9"></stop>
                            <stop offset="100%" stop-color="#60a5fa" stop-opacity="0"></stop>
                          </linearGradient>
                        </defs>
                        <polygon id="weatherChartArea" fill="url(#weatherChartGradient)" opacity="0.35" points=""></polygon>
                        <polyline id="weatherChartLineHigh" fill="none" stroke="#f97316" stroke-width="1.2" points=""></polyline>
                        <polyline id="weatherChartLineLow" fill="none" stroke="#3b82f6" stroke-width="1.2" points=""></polyline>
                      </svg>
                   </div>
                   <!-- 6. 最低温数字 -->
                   <div class="weather-forecast-row weather-forecast-temps weather-forecast-temps-low" id="weatherChartTempsLow"></div>
                   <!-- 7. 最低温天气图示 -->
                   <div class="weather-forecast-row weather-forecast-icons weather-forecast-icons-low" id="weatherChartIconsLow"></div>
                </div>
                <!-- footer removed, update time moved to header -->
             </div>
             <div class="visitor-card">
               <div class="visitor-card-header">
                 <div class="visitor-card-title">
                   <i class="ri-bar-chart-2-line"></i>
                   <span>站点访客</span>
                 </div>
               </div>
               <div class="visitor-card-body" style="position: relative; padding: 0;">
                 <!-- 自定义样式展示层 -->
                 <div id="visitor_custom_ui" style="display: flex; flex-direction: column; gap: 12px; width: 100%;">
                    <div class="visitor-metric-row" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px dashed #f1f5f9; padding-bottom: 8px;">
                        <span style="font-size: 12px; color: #64748b;">当前在线</span>
                        <span id="custom_online" style="font-size: 18px; font-weight: 700; color: #10b981; font-family: 'SF Mono', monospace;">--</span>
                    </div>
                    <div class="visitor-metric-row" style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px dashed #f1f5f9; padding-bottom: 8px;">
                        <span style="font-size: 12px; color: #64748b;">今日访客</span>
                        <span id="custom_today" style="font-size: 18px; font-weight: 700; color: #0f172a; font-family: 'SF Mono', monospace;">--</span>
                    </div>
                    <div class="visitor-metric-row" style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 12px; color: #64748b;">累计访客</span>
                        <span id="custom_total" style="font-size: 18px; font-weight: 700; color: #0f172a; font-family: 'SF Mono', monospace;">--</span>
                    </div>
                 </div>

                 <!-- 51.la 原始挂件 (隐藏抓取数据源) -->
                 <div id="la_data_container" style="opacity: 0; position: absolute; top: 0; left: 0; z-index: -1; height: 0; overflow: hidden; pointer-events: none;">
                    <!-- display参数全开，确保能抓到所有数据 -->
                    <script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/3OBuXueXb41ODfzv/quote.js?theme=0&col=true&f=12&badge=icon_0&icon=center&display=1,1,1,0,0,0,0,1"></script>
                 </div>
               </div>
             </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 搜索区域（参考 AI 工具集顶部搜索） -->
    <section class="search-section">
      <div class="search-section-inner">
        <div class="search-tabs" id="searchTabs">
          <div class="search-tab is-active" data-key="common">常用</div>
          <div class="search-tab" data-key="search">搜索</div>
          <div class="search-tab" data-key="community">社区</div>
          <div class="search-tab" data-key="image">图片</div>
        </div>
        <div class="search-main">
          <input id="searchMainInput" class="search-main-input" placeholder="站内 AI 工具搜索" />
          <div class="search-main-icon" id="searchMainButton"><i class="ri-search-line"></i></div>
          <div class="search-main-arrow" id="searchArrow"></div>
        </div>
        <div class="search-engines" id="searchEngines">
          <!-- JS 渲染搜索引擎标签 -->
        </div>
      </div>
    </section>

    <!-- 工具分类（搜索下方整块罗列各个类别，数据来自 JS 渲染） -->
    <section class="tool-layout">
      <div class="tool-list" id="toolListContainer"></div>
    </section>
  </div>
</div>

<button class="back-to-top" id="backToTop" aria-label="回到顶部"><i class="ri-arrow-up-line"></i></button>

  <!-- Modal Dialog Structure -->
  <div id="configModal" class="modal-overlay">
    <div class="modal-box">
      <div class="modal-header">
        <h3 id="modalTitle">标题</h3>
        <i class="ri-close-line modal-close" id="modalCloseBtn"></i>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Inputs will be injected here -->
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel" id="modalCancelBtn">取消</button>
        <button class="modal-btn confirm" id="modalConfirmBtn">确定</button>
      </div>
    </div>
  </div>

  <script>
  // 顶部时间（翻页时钟）
  (function () {
    var dateEl = document.getElementById("navDate");
    var extraEl = document.getElementById("navExtra");

    var flipHour = document.getElementById("flipHour");
    var flipMin = document.getElementById("flipMin");
    var flipSec = document.getElementById("flipSec");

    if (!flipHour || !flipMin || !flipSec) return;

    // Helper: 更新单个翻页单元
    function updateFlipUnit(unitEl, newValue) {
        var currentVal = unitEl.getAttribute("data-val") || "00";
        if (newValue === currentVal) return;

        // 设置新值
        unitEl.setAttribute("data-val", newValue);

        // 创建动画元素
        // 顶部翻到底部: top (old) -> anim-top (old, rotates down)
        // 底部显示新值: bottom (old) -> anim-bottom (new, rotates up)
        
        var top = unitEl.querySelector(".flip-top");
        var bottom = unitEl.querySelector(".flip-bottom");

        // 1. 设置动画前的状态
        var animTop = document.createElement("div");
        animTop.className = "flip-top flip-anim-top";
        animTop.textContent = currentVal;

        var animBottom = document.createElement("div");
        animBottom.className = "flip-bottom flip-anim-bottom";
        animBottom.textContent = newValue;

        unitEl.appendChild(animTop);
        unitEl.appendChild(animBottom);

        // 2. 更新静态底层的值（新值在下，但在动画层覆盖下不可见，直到动画结束）
        // Top 立即更新为新值（被 animTop 遮挡）
        top.textContent = newValue;
        // Bottom 暂时保持旧值（被 animBottom 遮挡前可见），动画结束后再更新

        // 3. 动画结束后清理
        setTimeout(function() {
            if(unitEl.contains(animTop)) unitEl.removeChild(animTop);
            if(unitEl.contains(animBottom)) unitEl.removeChild(animBottom);
            // 动画结束，更新底部为新值
            bottom.textContent = newValue;
        }, 600); // match CSS animation duration
    }

    var weekMap = ["日", "一", "二", "三", "四", "五", "六"];
    var tianGan = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
    var diZhi = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
    var lunarMonthNames = ["正", "二", "三", "四", "五", "六", "七", "八", "九", "十", "冬", "腊"];

    function lunarDayName(d) {
      var nStr1 = ["", "一", "二", "三", "四", "五", "六", "七", "八", "九"];
      var nStr2 = ["初", "十", "廿", "三十"];
      if (d === 10) return "初十";
      if (d === 20) return "二十";
      if (d === 30) return "三十";
      var two = Math.floor(d / 10);
      var one = d % 10;
      return nStr2[two] + nStr1[one];
    }

    function pad(n) {
      return n < 10 ? "0" + n : "" + n;
    }

    function tick() {
      var now = new Date();
      var hh = pad(now.getHours());
      var mm = pad(now.getMinutes());
      var ss = pad(now.getSeconds());

      updateFlipUnit(flipHour, hh);
      updateFlipUnit(flipMin, mm);
      updateFlipUnit(flipSec, ss);

      var y = now.getFullYear();
      var m = pad(now.getMonth() + 1);
      var d = pad(now.getDate());
      var week = "周" + weekMap[now.getDay()];
      if (dateEl) dateEl.textContent = y + " 年 " + m + " 月 " + d + " 日";
      
      if (extraEl) {
        var ganIndex = (y - 4) % 10;
        var zhiIndex = (y - 4) % 12;
        if (ganIndex < 0) ganIndex += 10;
        if (zhiIndex < 0) zhiIndex += 12;
        var ganzhiYear = tianGan[ganIndex] + diZhi[zhiIndex] + "年";
        var lunarMonthName = lunarMonthNames[now.getMonth()] || "";
        var lunarDayStr = lunarDayName(now.getDate());
        extraEl.textContent = ganzhiYear + " · " + lunarMonthName + "月" + lunarDayStr + " · " + week;
      }
    }

    tick();
    setInterval(tick, 1000);
  })();

  // 搜索区域（顶部 tabs + 引擎列表 + 实际搜索逻辑）
  (function () {
    var tabsEl = document.getElementById("searchTabs");
    var enginesEl = document.getElementById("searchEngines");
    var inputEl = document.getElementById("searchMainInput");
    var searchBtnEl = document.getElementById("searchMainButton");
    var arrowEl = document.getElementById("searchArrow");
    var mainEl = document.querySelector(".search-main");
    if (!tabsEl || !enginesEl || !inputEl || !arrowEl || !mainEl) return;

    var config = {
      common: {
        placeholder: "输入关键词搜索",
        engines: ["站内", "Bing", "百度", "Google", "Perplexity"]
      },
      search: {
        placeholder: "输入关键词搜索",
        engines: ["Bing", "百度", "Google", "Perplexity", "YOU", "360", "搜狗", "神马"]
      },
      community: {
        placeholder: "输入关键词搜索",
        engines: ["Hugging Face", "GitHub", "飞桨", "魔搭", "和鲸", "掘金", "知乎"]
      },
      image: {
        placeholder: "输入关键词搜索",
        engines: ["文心一格", "花瓣AI圈", "Civitai", "OpenArt", "NightCafe", "DeviantArt", "Lexica"]
      }
    };

    var activeTab = "common";
    var activeEngine = "站内";

    function updatePlaceholder() {
      if (!inputEl) return;
      var text = "";
      if (activeEngine === "站内") {
        text = "站内 AI 工具搜索";
      } else if (activeEngine) {
        text = "在 " + activeEngine + " 中搜索";
      } else {
        var data = config[activeTab];
        text = data && data.placeholder ? data.placeholder : "输入关键词搜索";
      }
      inputEl.placeholder = text;
    }

    // 实际执行搜索
    function performSearch() {
      if (!inputEl) return;
      var kw = inputEl.value.trim();
      if (!kw) return;

      // 1）站内搜索：在工具卡片中查找并高亮
      if (activeEngine === "站内") {
        var cards = document.querySelectorAll(".tool-card");
        if (!cards.length) return;

        Array.prototype.forEach.call(cards, function (c) {
          c.classList.remove("tool-card-highlight");
        });

        var firstMatch = null;
        var lower = kw.toLowerCase();

        Array.prototype.forEach.call(cards, function (c) {
          var text = (c.textContent || "").toLowerCase();
          if (text.indexOf(lower) !== -1) {
            c.classList.add("tool-card-highlight");
            if (!firstMatch) firstMatch = c;
          }
        });

        if (firstMatch) {
          firstMatch.scrollIntoView({ behavior: "smooth", block: "center" });
        } else {
          alert("没有找到与「" + kw + "」相关的工具，换个关键词试试～");
        }
        return;
      }

      // 2）外部搜索引擎：根据当前引擎打开新标签页
      var map = {
        "Bing": "https://www.bing.com/search?q=",
        "百度": "https://www.baidu.com/s?wd=",
        "Google": "https://www.google.com/search?q=",
        "Perplexity": "https://www.perplexity.ai/search?q=",
        "YOU": "https://you.com/search?q=",
        "360": "https://www.so.com/s?q=",
        "搜狗": "https://www.sogou.com/web?query=",
        "神马": "https://so.m.sm.cn/s?q=",
        "Hugging Face": "https://huggingface.co/search?q=",
        "GitHub": "https://github.com/search?q=",
        "飞桨": "https://www.paddlepaddle.org.cn/search?query=",
        "魔搭": "https://modelscope.cn/search?query=",
        "和鲸": "https://www.heywhale.com/search?keyword=",
        "掘金": "https://juejin.cn/search?query=",
        "知乎": "https://www.zhihu.com/search?q=",
        "文心一格": "https://yige.baidu.com/search?query=",
        "花瓣AI圈": "https://huaban.com/search/?q=",
        "Civitai": "https://civitai.com/search?query=",
        "OpenArt": "https://openart.ai/search?term=",
        "NightCafe": "https://creator.nightcafe.studio/search?q=",
        "DeviantArt": "https://www.deviantart.com/search?q=",
        "Lexica": "https://lexica.art/?q="
      };

      var base = map[activeEngine] || "https://www.bing.com/search?q=";
      var url = base + encodeURIComponent(kw);
      window.open(url, "_blank", "noopener,noreferrer");
    }

    function renderEngines() {
      var data = config[activeTab];
      updatePlaceholder();
      enginesEl.innerHTML = "";
      var activeSpan = null;
      data.engines.forEach(function (name) {
        var span = document.createElement("span");
        span.className = "search-engine-item" + (name === activeEngine ? " is-active" : "");
        span.textContent = name;
        span.addEventListener("click", function () {
          activeEngine = name;
          renderEngines();
        });
        enginesEl.appendChild(span);
        if (name === activeEngine) {
          activeSpan = span;
        }
      });

      // 根据当前选中的搜索引擎，移动小箭头
      if (activeSpan) {
        var mainRect = mainEl.getBoundingClientRect();
        var spanRect = activeSpan.getBoundingClientRect();
        var center = spanRect.left + spanRect.width / 2 - mainRect.left;
        arrowEl.style.left = center + "px";
      }
    }

    Array.prototype.forEach.call(tabsEl.querySelectorAll(".search-tab"), function (tab) {
      tab.addEventListener("click", function () {
        var key = tab.getAttribute("data-key");
        if (!config[key]) return;
        activeTab = key;
        activeEngine = config[key].engines[0];
        Array.prototype.forEach.call(tabsEl.querySelectorAll(".search-tab"), function (t) {
          t.classList.toggle("is-active", t === tab);
        });
        renderEngines();
      });
    });

    renderEngines();
    
    inputEl.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        performSearch();
      }
    });

    if (searchBtnEl) {
      searchBtnEl.addEventListener("click", function () {
        performSearch();
      });
    }

    // 点击空白处时清除站内搜索高亮
    document.addEventListener("click", function (e) {
      var target = e.target;
      // 如果点击在搜索区域或工具卡片内，则不清除
      if (
        target.closest(".search-section-inner") ||
        target.closest(".search-main") ||
        target.closest(".search-engines") ||
        target.closest(".search-tabs") ||
        target.closest(".tool-card")
      ) {
        return;
      }
      var cards = document.querySelectorAll(".tool-card-highlight");
      Array.prototype.forEach.call(cards, function (c) {
        c.classList.remove("tool-card-highlight");
      });
    });
  })();


    // 工具分类渲染 & 配置管理
    (function () {
        var containerEl = document.getElementById("toolListContainer");
        var sidebarEl = document.querySelector(".side-menu");
        var configBtn = document.getElementById("configToggleBtn");
        if (!containerEl) return;

        var isConfigMode = false;
        var STORAGE_KEY = "nav_tools_data_v1";
        var RECENT_KEY = "nav_recent_tools_v1";

        // Modal Logic (Integrated here to ensure availability)
        var modalOverlay = document.getElementById("configModal");
        var modalCloseBtn = document.getElementById("modalCloseBtn");
        var modalCancelBtn = document.getElementById("modalCancelBtn");
        var modalConfirmBtn = document.getElementById("modalConfirmBtn");
        var modalTitle = document.getElementById("modalTitle");
        var modalBody = document.getElementById("modalBody");
        var onModalConfirm = null;

        function closeModal() {
            modalOverlay.classList.remove("is-visible");
            setTimeout(function() { modalBody.innerHTML = ""; }, 200);
        }

        function showModal(title, fields, confirmCallback, isDanger) {
            modalTitle.textContent = title;
            modalBody.innerHTML = "";
            onModalConfirm = confirmCallback;

            if (isDanger) {
                modalConfirmBtn.classList.add("danger");
                modalConfirmBtn.textContent = "删除";
            } else {
                modalConfirmBtn.classList.remove("danger");
                modalConfirmBtn.textContent = "确定";
            }

            if (typeof fields === "string") {
                var p = document.createElement("p");
                p.style.fontSize = "14px";
                p.style.color = "#475569";
                p.textContent = fields;
                modalBody.appendChild(p);
            } else {
                fields.forEach(function(field) {
                    var group = document.createElement("div");
                    group.className = "form-group";
                    var label = document.createElement("label");
                    label.className = "form-label";
                    label.textContent = field.label;
                    var input = document.createElement("input");
                    input.className = "form-input";
                    input.value = field.value || "";
                    input.placeholder = field.placeholder || "";
                    input.setAttribute("data-key", field.key);
                    if (field.type) input.type = field.type;
                    group.appendChild(label);
                    group.appendChild(input);
                    modalBody.appendChild(group);
                });
            }

            modalOverlay.classList.add("is-visible");
            var firstInput = modalBody.querySelector("input");
            if (firstInput) setTimeout(function(){ firstInput.focus(); }, 50);
        }

        if (modalCloseBtn) modalCloseBtn.onclick = closeModal;
        if (modalCancelBtn) modalCancelBtn.onclick = closeModal;
        if (modalOverlay) modalOverlay.onclick = function(e) { if (e.target === modalOverlay) closeModal(); };
        
        if (modalConfirmBtn) {
            modalConfirmBtn.onclick = function() {
                if (onModalConfirm) {
                    var inputs = modalBody.querySelectorAll("input");
                    if (inputs.length > 0) {
                        var data = {};
                        inputs.forEach(function(input) {
                            data[input.getAttribute("data-key")] = input.value.trim();
                        });
                        onModalConfirm(data);
                    } else {
                        onModalConfirm();
                    }
                }
                closeModal();
            };
        }

        // 默认数据
        var defaultData = [
            {
                key: "text",
                name: "AI文本工具",
                icon: '<i class="ri-file-text-line"></i>',
                items: [
                    { name: "ChatGPT", desc: "OpenAI 官方的多语言对话与写作助手", link: "https://chatgpt.com", icon: "https://chatgpt.com/favicon.ico" },
                    { name: "Claude", desc: "Anthropic 出品的大语言模型，对话体验自然、长文能力强", link: "https://claude.ai", icon: "https://claude.ai/favicon.ico" },
                    { name: "Gemini", desc: "Google 推出的 Gemini 模型，对话、搜索和办公一体", link: "https://gemini.google.com", icon: "https://gemini.google.com/favicon.ico" },
                    { name: "通义千问", desc: "阿里云出品的中文友好大模型，对话、代码、办公一站式", link: "https://tongyi.aliyun.com/qianwen", icon: "https://tongyi.aliyun.com/favicon.ico" },
                    { name: "文心一言", desc: "百度文心大模型的对话入口，支持搜索增强和创作", link: "https://yiyan.baidu.com", icon: "https://yiyan.baidu.com/static/favicon.ico" },
                    { name: "智谱清言", desc: "智谱 AI 的对话产品，基于 GLM 系列模型", link: "https://chatglm.cn", icon: "https://chatglm.cn/favicon.ico" },
                    { name: "讯飞星火", desc: "科大讯飞推出的大模型产品，擅长中文问答和办公场景", link: "https://xinghuo.xfyun.cn", icon: "https://xinghuo.xfyun.cn/favicon.ico" },
                    { name: "Kimi", desc: "Moonshot AI 的长文助手，支持阅读和总结超长内容", link: "https://kimi.moonshot.cn", icon: "https://kimi.moonshot.cn/favicon.ico" },
                    { name: "豆包", desc: "字节跳动推出的智能助理，支持对话、写作和办公", link: "https://www.doubao.com", icon: "https://www.doubao.com/favicon.ico" },
                    { name: "Poe", desc: "Quora 出品的多模型聚合聊天平台，集成多家大模型", link: "https://poe.com", icon: "https://poe.com/favicon.ico" }
                ]
            },
            {
                key: "image",
                name: "AI图像工具",
                icon: '<i class="ri-image-line"></i>',
                items: [
                    { name: "Midjourney", desc: "高质量 AI 作画社区，通过 Discord 使用", link: "https://www.midjourney.com", icon: "https://www.midjourney.com/favicon.ico" },
                    { name: "DALL·E", desc: "OpenAI 的图片生成模型，支持 DALL·E 3", link: "https://labs.openai.com", icon: "https://labs.openai.com/favicon.ico" },
                    { name: "Stable Diffusion", desc: "开源图像生成模型生态，支持本地和云端部署", link: "https://stability.ai", icon: "https://stability.ai/favicon.ico" },
                    { name: "文心一格", desc: "百度出品的中文 AI 绘画平台", link: "https://yige.baidu.com", icon: "https://yige.baidu.com/favicon.ico" },
                    { name: "通义万相", desc: "阿里通义系列的图像生成平台", link: "https://wanxiang.aliyun.com", icon: "https://wanxiang.aliyun.com/favicon.ico" },
                    { name: "Civitai", desc: "Stable Diffusion 模型与作品分享社区", link: "https://civitai.com", icon: "https://civitai.com/favicon.ico" },
                    { name: "OpenArt", desc: "多模型在线生图与作品社区", link: "https://openart.ai", icon: "https://openart.ai/favicon.ico" },
                    { name: "NightCafe", desc: "支持多种模型的在线 AI 作画网站", link: "https://creator.nightcafe.studio", icon: "https://creator.nightcafe.studio/favicon.ico" },
                    { name: "Lexica", desc: "基于 Stable Diffusion 的图库和提示词搜索网站", link: "https://lexica.art", icon: "https://lexica.art/favicon.ico" },
                    { name: "Adobe Firefly", desc: "Adobe 推出的生成式图像与设计工具", link: "https://firefly.adobe.com", icon: "https://firefly.adobe.com/favicon.ico" }
                ]
            },
            {
                key: "video",
                name: "AI视频工具",
                icon: '<i class="ri-movie-line"></i>',
                items: [
                    { name: "Runway", desc: "集剪辑、特效和文生视频于一体的 AI 视频平台", link: "https://runwayml.com", icon: "https://runwayml.com/favicon.ico" },
                    { name: "Pika", desc: "支持文生视频、图生视频的创意视频平台", link: "https://pika.art", icon: "https://pika.art/favicon.ico" },
                    { name: "HeyGen", desc: "数字人和口播视频生成平台", link: "https://www.heygen.com", icon: "https://www.heygen.com/favicon.ico" },
                    { name: "Synthesia", desc: "企业级数字人视频生成工具", link: "https://www.synthesia.io", icon: "https://www.synthesia.io/favicon.ico" },
                    { name: "Descript", desc: "集剪辑、配音、转写于一体的音视频编辑工具", link: "https://www.descript.com", icon: "https://www.descript.com/favicon.ico" },
                    { name: "Opus Clip", desc: "长视频智能切片成多条短视频", link: "https://www.opus.pro", icon: "https://www.opus.pro/favicon.ico" },
                    { name: "Veed.io", desc: "在线视频编辑与字幕、特效工具", link: "https://www.veed.io", icon: "https://www.veed.io/favicon.ico" },
                    { name: "CapCut 剪映", desc: "字节出品的短视频剪辑工具，内置多种 AI 能力", link: "https://www.capcut.com", icon: "https://www.capcut.com/favicon.ico" }
                ]
            },
            {
                key: "audio",
                name: "AI音频工具",
                icon: '<i class="ri-headphone-line"></i>',
                items: [
                    { name: "ElevenLabs", desc: "高质量多语种 TTS 配音平台", link: "https://elevenlabs.io", icon: "https://elevenlabs.io/favicon.ico" },
                    { name: "Suno", desc: "输入一句话就能生成完整歌曲的 AI 音乐平台", link: "https://suno.ai", icon: "https://suno.ai/favicon.ico" },
                    { name: "Udio", desc: "专注音乐创作的生成式 AI 工具", link: "https://www.udio.com", icon: "https://www.udio.com/favicon.ico" },
                    { name: "Adobe Podcast", desc: "Adobe 出品的播客录制与音频增强工具", link: "https://podcast.adobe.com", icon: "https://podcast.adobe.com/favicon.ico" },
                    { name: "AIVA", desc: "面向配乐和影视的 AI 作曲平台", link: "https://www.aiva.ai", icon: "https://www.aiva.ai/favicon.ico" },
                    { name: "Krisp", desc: "会议场景的 AI 降噪工具", link: "https://krisp.ai", icon: "https://krisp.ai/favicon.ico" },
                    { name: "Murf AI", desc: "配音和多语言旁白生成平台", link: "https://murf.ai", icon: "https://murf.ai/favicon.ico" },
                    { name: "Voicemod", desc: "变声与实时语音效果工具", link: "https://www.voicemod.net", icon: "https://www.voicemod.net/favicon.ico" }
                ]
            },
            {
                key: "office",
                name: "AI办公工具",
                icon: '<i class="ri-briefcase-4-line"></i>',
                items: [
                    { name: "Notion AI", desc: "集笔记、文档和数据库于一体的工作空间，内置 AI 助手", link: "https://www.notion.so", icon: "https://www.notion.so/favicon.ico" },
                    { name: "飞书文档", desc: "字节跳动出品的协作套件，支持 AI 总结和写作", link: "https://www.feishu.cn", icon: "https://www.feishu.cn/favicon.ico" },
                    { name: "石墨文档", desc: "国内老牌在线文档工具，支持智能写作", link: "https://shimo.im", icon: "https://shimo.im/favicon.ico" },
                    { name: "Microsoft Copilot", desc: "深度集成在 Office / Windows 里的 AI 助手", link: "https://www.microsoft.com/microsoft-365/copilot", icon: "https://www.microsoft.com/favicon.ico" },
                    { name: "Google Workspace", desc: "Gmail / Docs / Sheets 等协作套件，内置 Gemini 能力", link: "https://workspace.google.com", icon: "https://workspace.google.com/favicon.ico" },
                    { name: "Slack", desc: "团队沟通工具，支持 AI 总结和智能搜索", link: "https://slack.com", icon: "https://slack.com/favicon.ico" },
                    { name: "AiPPT", desc: "中文场景友好的 AI PPT 生成工具", link: "https://www.aippt.cn", icon: "https://www.aippt.cn/favicon.ico" },
                    { name: "ClickUp AI", desc: "项目管理与任务协作平台，集成 AI 写作和总结", link: "https://clickup.com/ai", icon: "https://clickup.com/favicon.ico" }
                ]
            },
            {
                key: "code",
                name: "AI编程工具",
                icon: '<i class="ri-code-s-slash-line"></i>',
                items: [
                    { name: "GitHub Copilot", desc: "GitHub 与 OpenAI 联合推出的 AI 编程助手", link: "https://github.com/features/copilot", icon: "https://github.githubassets.com/favicons/favicon.svg" },
                    { name: "Cursor", desc: "基于大模型的下一代编程 IDE", link: "https://cursor.sh", icon: "https://cursor.sh/favicon.ico" },
                    { name: "Codeium", desc: "支持多种编辑器的免费 AI 补全与重构工具", link: "https://codeium.com", icon: "https://codeium.com/favicon.ico" },
                    { name: "Replit", desc: "在线开发环境，支持 AI 生成和补全代码", link: "https://replit.com", icon: "https://replit.com/favicon.ico" },
                    { name: "Tabnine", desc: "老牌 AI 代码补全插件，支持本地与云端模型", link: "https://www.tabnine.com", icon: "https://www.tabnine.com/favicon.ico" },
                    { name: "AWS CodeWhisperer", desc: "亚马逊推出的云原生 AI 编程助手", link: "https://aws.amazon.com/codewhisperer/", icon: "https://aws.amazon.com/favicon.ico" },
                    { name: "JetBrains AI", desc: "JetBrains 全系列 IDE 的内置 AI 助手", link: "https://www.jetbrains.com/ai/", icon: "https://www.jetbrains.com/favicon.ico" },
                    { name: "CodeGeeX", desc: "面向中文和多语言的开源代码大模型工具链", link: "https://codegeex.cn", icon: "https://codegeex.cn/favicon.ico" }
                ]
            },
            {
                key: "design",
                name: "AI设计工具",
                icon: '<i class="ri-palette-line"></i>',
                items: [
                    { name: "Figma", desc: "主流 UI / UX 设计协作工具，支持 AI 辅助", link: "https://www.figma.com", icon: "https://www.figma.com/favicon.ico" },
                    { name: "Canva", desc: "人人可用的在线设计平台，内置大量 AI 功能", link: "https://www.canva.com", icon: "https://www.canva.com/favicon.ico" },
                    { name: "Framer", desc: "可视化建站工具，支持 AI 一键生成网站", link: "https://www.framer.com", icon: "https://www.framer.com/favicon.ico" },
                    { name: "Uizard", desc: "支持草图转界面的原型设计工具", link: "https://uizard.io", icon: "https://uizard.io/favicon.ico" },
                    { name: "Visily", desc: "面向产品和运营的低门槛原型设计工具", link: "https://www.visily.ai", icon: "https://www.visily.ai/favicon.ico" },
                    { name: "Diagram", desc: "Figma 生态中的 AI 设计助手", link: "https://diagram.com", icon: "https://diagram.com/favicon.ico" }
                ]
            },
            {
                key: "news",
                name: "AI资讯工具",
                icon: '<i class="ri-newspaper-line"></i>',
                items: [
                    { name: "AI工具集导航", desc: "中文 AI 工具和资讯导航站", link: "https://ai-bot.cn", icon: "https://ai-bot.cn/favicon.ico" },
                    { name: "Futurepedia", desc: "收录上千款 AI 工具的英文导航网站", link: "https://www.futurepedia.io", icon: "https://www.futurepedia.io/favicon.ico" },
                    { name: "TopAI Tools", desc: "聚合热门 AI 产品和工具的导航站", link: "https://topai.tools", icon: "https://topai.tools/favicon.ico" },
                    { name: "Hugging Face", desc: "开源模型社区，同时也是 AI 资讯与教程中心", link: "https://huggingface.co", icon: "https://huggingface.co/favicon.ico" },
                    { name: "OpenAI Blog", desc: "OpenAI 官方博客，发布产品更新与技术文章", link: "https://openai.com/blog", icon: "https://openai.com/favicon.ico" },
                    { name: "Anthropic News", desc: "Anthropic 官方新闻与技术动态", link: "https://www.anthropic.com/news", icon: "https://www.anthropic.com/favicon.ico" },
                    { name: "DeepLearning.ai", desc: "Ng 团队运营的 AI 教程与新闻平台", link: "https://www.deeplearning.ai", icon: "https://www.deeplearning.ai/favicon.ico" }
                ]
            },
            {
                key: "model",
                name: "AI模型工具",
                icon: '<i class="ri-cpu-line"></i>',
                items: [
                    { name: "Hugging Face Models", desc: "最大规模的开源模型与数据集仓库", link: "https://huggingface.co/models", icon: "https://huggingface.co/favicon.ico" },
                    { name: "ModelScope 魔搭社区", desc: "阿里巴巴达摩院的模型社区，提供大量开源模型", link: "https://modelscope.cn", icon: "https://modelscope.cn/favicon.ico" },
                    { name: "OpenAI Platform", desc: "OpenAI 模型调用与管理平台", link: "https://platform.openai.com", icon: "https://platform.openai.com/favicon.ico" },
                    { name: "Google AI Studio", desc: "Gemini 等模型的在线试用与 API 控制台", link: "https://ai.google.dev", icon: "https://ai.google.dev/favicon.ico" },
                    { name: "Anthropic Console", desc: "Claude 模型的 API 控制台和工具集", link: "https://console.anthropic.com", icon: "https://console.anthropic.com/favicon.ico" },
                    { name: "Replicate", desc: "按调用计费的模型托管与部署平台", link: "https://replicate.com", icon: "https://replicate.com/favicon.ico" },
                    { name: "Together AI", desc: "聚合多家开源和商用模型的推理平台", link: "https://www.together.ai", icon: "https://www.together.ai/favicon.ico" },
                    { name: "Cohere", desc: "提供文本与嵌入等多种企业级模型服务", link: "https://cohere.com", icon: "https://cohere.com/favicon.ico" }
                ]
            },
            {
                key: "prompt",
                name: "AI指令工具",
                icon: '<i class="ri-lightbulb-line"></i>',
                items: [
                    { name: "PromptBase", desc: "可买卖提示词的专业 Prompt 市场", link: "https://promptbase.com", icon: "https://promptbase.com/favicon.ico" },
                    { name: "FlowGPT", desc: "聚合社区优秀提示词与工作流的平台", link: "https://flowgpt.com", icon: "https://flowgpt.com/favicon.ico" },
                    { name: "PromptHero", desc: "面向绘画和多模态的提示词社区", link: "https://prompthero.com", icon: "https://prompthero.com/favicon.ico" },
                    { name: "AIPRM", desc: "为 ChatGPT 等模型提供大量预设提示词模板", link: "https://www.aiprm.com", icon: "https://www.aiprm.com/favicon.ico" },
                    { name: "Awesome ChatGPT Prompts", desc: "GitHub 上整理的高质量 ChatGPT 提示词集合", link: "https://github.com/f/awesome-chatgpt-prompts", icon: "https://github.githubassets.com/favicons/favicon.svg" },
                    { name: "Learn Prompting", desc: "系统讲解提示工程知识的开源课程", link: "https://learnprompting.org", icon: "https://learnprompting.org/favicon.ico" },
                    { name: "SnackPrompt", desc: "可收藏和分享的提示词小组件平台", link: "https://snackprompt.com", icon: "https://snackprompt.com/favicon.ico" },
                    { name: "PromptingGuide", desc: "介绍最佳实践和范式的 Prompt 指南站点", link: "https://promptingguide.ai", icon: "https://promptingguide.ai/favicon.ico" }
                ]
            }
        ];

        // 加载数据
        function loadData() {
            var saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try { return JSON.parse(saved); } catch (e) { console.error("Failed to parse saved tools data", e); }
            }
            return defaultData;
        }

        // 加载最近访问
        function loadRecent() {
            var saved = localStorage.getItem(RECENT_KEY);
            if (saved) {
                try { return JSON.parse(saved); } catch (e) { console.error("Failed to parse recent tools", e); }
            }
            return [];
        }

        // 添加到最近访问
        function addToRecent(item) {
            if (!item || !item.name) return;
            var list = loadRecent();
            list = list.filter(function(r) { return r.name !== item.name; });
            list.unshift(item);
            if (list.length > 10) list = list.slice(0, 10);
            localStorage.setItem(RECENT_KEY, JSON.stringify(list));
            renderAll(currentData);
        }

        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            renderAll(data);
        }

        var currentData = loadData();

        function renderAll(data) {
            renderSidebar(data);
            renderTools(data);
        }

        function renderSidebar(data) {
            if (!sidebarEl) return;
            sidebarEl.innerHTML = "";
            
            // REMOVED Recent Visits from Sidebar
            
            data.forEach(function(cat, index) {
                var li = document.createElement("li");
                li.setAttribute("data-section-id", "tool-section-" + cat.key);
                
                var inner = document.createElement("div");
                inner.className = "side-menu-inner";
                inner.innerHTML = cat.icon + " " + cat.name;
                
                var arrow = document.createElement("i");
                arrow.className = "ri-arrow-right-s-line side-menu-arrow";

                li.appendChild(inner);
                li.appendChild(arrow);

                var actions = document.createElement("div");
                actions.className = "sidebar-item-actions";
                
                var editBtn = document.createElement("div");
                editBtn.className = "sidebar-action-btn edit";
                editBtn.innerHTML = '<i class="ri-edit-line"></i>';
                editBtn.title = "编辑分组";
                editBtn.onclick = function(e) { e.stopPropagation(); editGroup(index); };

                var delBtn = document.createElement("div");
                delBtn.className = "sidebar-action-btn delete";
                delBtn.innerHTML = '<i class="ri-delete-bin-line"></i>';
                delBtn.title = "删除分组";
                delBtn.onclick = function(e) { e.stopPropagation(); deleteGroup(index); };

                actions.appendChild(editBtn);
                actions.appendChild(delBtn);
                li.appendChild(actions);

                li.addEventListener("click", function (event) {
                    if (isConfigMode && event.target.closest(".sidebar-item-actions")) return;
                    var targetId = li.getAttribute("data-section-id");
                    if (!targetId) return;
                    var target = document.getElementById(targetId);
                    if (!target) return;
                    var rect = target.getBoundingClientRect();
                    var top = rect.top + window.scrollY - 12;
                    window.scrollTo({ top: top, behavior: "smooth" });
                });

                sidebarEl.appendChild(li);
            });

            var addLi = document.createElement("div");
            addLi.className = "sidebar-add-btn";
            addLi.innerHTML = "+ 新增分组";
            addLi.onclick = addGroup;
            sidebarEl.appendChild(addLi);
        }

        function renderTools(data) {
            containerEl.innerHTML = "";
            
            // Render Recent
            var recentList = loadRecent();
            if (recentList.length > 0) {
                var recentCat = {
                    key: "recent",
                    name: "最近访问",
                    icon: '<i class="ri-history-line"></i>',
                    items: recentList
                };
                renderCategory(recentCat, -1, true); 
            }

            data.forEach(function(cat, index) {
                renderCategory(cat, index, false);
            });
        }

        function renderCategory(cat, catIndex, isReadOnly) {
            var section = document.createElement("section");
            section.className = "tool-section";
            section.id = "tool-section-" + cat.key;

            var header = document.createElement("div");
            header.className = "tool-section-header";
            header.innerHTML = '<span class="tool-tag-icon">' + cat.icon + '</span><span class="tool-list-title">' + cat.name + '</span>';
            section.appendChild(header);

            var grid = document.createElement("div");
            grid.className = "tool-grid";

            if (cat.items && cat.items.length) {
                cat.items.forEach(function(item, itemIndex) {
                    var card = document.createElement("div");
                    card.className = "tool-card";
                    
                    var link = document.createElement("a");
                    link.style.display = "flex";
                    link.style.alignItems = "center";
                    link.style.width = "100%";
                    link.style.textDecoration = "none";
                    link.style.color = "inherit";
                    
                    link.href = item.link || "#";
                    link.target = item.link ? "_blank" : "_self";
                    link.rel = "noopener noreferrer";
                    
                    link.onclick = function(e) {
                        if (isConfigMode) {
                            e.preventDefault();
                        } else {
                            if (!isReadOnly) addToRecent(item); // Only record if from main list
                        }
                    };

                    var iconUrl = "https://www.google.com/s2/favicons?domain_url=" + (item.link || "") + "&sz=64";
                    var iconInner = '<img src="' + iconUrl + '" alt="' + item.name + '" loading="lazy" />';

                    link.innerHTML =
                        '<div class="tool-card-header" style="width:100%;">' + 
                        '<div class="tool-card-icon">' + iconInner + '</div>' +
                        '<div class="tool-card-body"><div class="tool-card-name">' + item.name + '</div>' +
                        '<div class="tool-card-desc">' + (item.desc || "") + '</div></div>' +
                        '</div>';
                    
                    var img = link.querySelector("img");
                    if (img) {
                        img.onerror = function () {
                            var parent = img.parentNode;
                            if (parent) {
                                parent.classList.add("has-fallback");
                                var firstLetter = (item.name || "A")[0].toUpperCase();
                                parent.innerHTML = "<span>" + firstLetter + "</span>";
                            }
                        };
                    }

                    card.appendChild(link);

                    if (!isReadOnly) {
                        var actions = document.createElement("div");
                        actions.className = "tool-card-actions";
                        
                        var editBtn = document.createElement("div");
                        editBtn.className = "tool-action-btn edit";
                        editBtn.innerHTML = '<i class="ri-edit-line"></i>';
                        editBtn.onclick = function(e) { e.stopPropagation(); editTool(catIndex, itemIndex); };

                        var delBtn = document.createElement("div");
                        delBtn.className = "tool-action-btn delete";
                        delBtn.innerHTML = '<i class="ri-delete-bin-line"></i>';
                        delBtn.onclick = function(e) { e.stopPropagation(); deleteTool(catIndex, itemIndex); };

                        actions.appendChild(editBtn);
                        actions.appendChild(delBtn);
                        card.appendChild(actions);
                    }

                    grid.appendChild(card);
                });
            } else {
                var empty = document.createElement("div");
                empty.textContent = "暂无工具";
                empty.style.fontSize = "12px";
                empty.style.color = "#9ca3af";
                empty.style.padding = "10px";
                grid.appendChild(empty);
            }

            if (!isReadOnly) {
                var addBtn = document.createElement("div");
                addBtn.className = "tool-card-add";
                addBtn.innerHTML = '<i class="ri-add-line" style="font-size:24px;"></i><span style="font-size:12px;">添加工具</span>';
                addBtn.onclick = function() { addTool(catIndex); };
                grid.appendChild(addBtn);
            }

            section.appendChild(grid);
            containerEl.appendChild(section);
        }

        // Logic (Config)
        function toggleMode() {
            isConfigMode = !isConfigMode;
            document.body.classList.toggle("is-config-mode", isConfigMode);
            configBtn.classList.toggle("is-active", isConfigMode);
        }

        function addGroup() {
            showModal("新增分组", [
                { label: "分组名称", key: "name", placeholder: "例如：AI视频工具" },
                { label: "唯一标识 (Key)", key: "key", value: "group_" + Date.now() },
                { label: "图标类名 (Remix Icon)", key: "icon", value: "ri-folder-line", placeholder: "ri-folder-line" }
            ], function(data) {
                if (!data.name || !data.key) return;
                currentData.push({ key: data.key, name: data.name, icon: '<i class="' + (data.icon || 'ri-folder-line') + '"></i>', items: [] });
                saveData(currentData);
            });
        }

        function editGroup(index) {
            var cat = currentData[index];
            var iconClassMatches = cat.icon.match(/class="([^"]+)"/);
            var currentIcon = iconClassMatches ? iconClassMatches[1] : "ri-folder-line";
            showModal("编辑分组", [
                { label: "分组名称", key: "name", value: cat.name },
                { label: "图标类名 (Remix Icon)", key: "icon", value: currentIcon }
            ], function(data) {
                if (data.name) cat.name = data.name;
                if (data.icon) cat.icon = '<i class="' + data.icon + '"></i>';
                saveData(currentData);
            });
        }

        function deleteGroup(index) {
            showModal("删除分组", "确定要删除这个分组及其下所有工具吗？此操作不可恢复。", function() {
                currentData.splice(index, 1);
                saveData(currentData);
            }, true);
        }

        function addTool(catIndex) {
            showModal("添加工具", [
                { label: "工具名称", key: "name", placeholder: "例如：ChatGPT" },
                { label: "链接地址", key: "link", value: "https://", placeholder: "https://..." },
                { label: "简短描述", key: "desc", placeholder: "一句话描述功能..." }
            ], function(data) {
                if (!data.name) return;
                currentData[catIndex].items.push({ name: data.name, link: data.link, desc: data.desc, icon: "" });
                saveData(currentData);
            });
        }

        function editTool(catIndex, toolIndex) {
            var item = currentData[catIndex].items[toolIndex];
            showModal("编辑工具", [
                { label: "工具名称", key: "name", value: item.name },
                { label: "链接地址", key: "link", value: item.link },
                { label: "简短描述", key: "desc", value: item.desc }
            ], function(data) {
                if (data.name) item.name = data.name;
                item.link = data.link;
                item.desc = data.desc;
                saveData(currentData);
            });
        }

        function deleteTool(catIndex, toolIndex) {
            showModal("删除工具", "确定要删除这个工具吗？", function() {
                currentData[catIndex].items.splice(toolIndex, 1);
                saveData(currentData);
            }, true);
        }

        if (configBtn) configBtn.addEventListener("click", toggleMode);
        renderAll(currentData);

    })();




  // 自动获取天气（IP 定位 + 缓存）
  (function () {
    var nameEl = document.getElementById("weatherCityName");
    var updateTimeEl = document.getElementById("weatherUpdateTime");
    var tempEl = document.getElementById("weatherTemp");
    var descEl = document.getElementById("weatherDesc");
    var iconEl = document.getElementById("weatherIcon");
    
    // 未来几天气温趋势图（高温 + 低温双折线）
    var chartSvgEl = document.getElementById("weatherChart");
    var chartHighLineEl = document.getElementById("weatherChartLineHigh");
    var chartLowLineEl = document.getElementById("weatherChartLineLow");
    var chartAreaEl = document.getElementById("weatherChartArea");
    // 自上而下：日期 / 高温图标 / 高温数字 / 折线 / 低温数字 / 低温图标
    var chartLabelsEl = document.getElementById("weatherChartLabels");
    var chartIconsHighEl = document.getElementById("weatherChartIconsHigh");
    var chartTempsHighEl = document.getElementById("weatherChartTempsHigh");
    var chartTempsLowEl = document.getElementById("weatherChartTempsLow");
    var chartIconsLowEl = document.getElementById("weatherChartIconsLow");
    var chartTitleEl = document.getElementById("weatherForecastTitle");

    var iconMap = {
      "Clear": "ri-sun-line", "Sunny": "ri-sun-line",
      "Partly cloudy": "ri-sun-cloudy-line",
      "Cloudy": "ri-cloudy-line", "Overcast": "ri-cloudy-2-line",
      "Mist": "ri-mist-line", "Fog": "ri-foggy-line", "Haze": "ri-haze-line",
      "Rain": "ri-rainy-line", "Light rain": "ri-drizzle-line", "Moderate rain": "ri-rainy-fill", "Heavy rain": "ri-heavy-showers-line",
      "Snow": "ri-snowy-line", "Light snow": "ri-snowy-line",
      "Thunder": "ri-thunderstorms-line", "Thunderstorm": "ri-thunderstorms-fill"
    };

    function renderWeather(data) {
        if (!data) return;
        var current = data.current_condition && data.current_condition[0];
        var nearest = data.nearest_area && data.nearest_area[0];
        if (!current) return;

        // 1. 城市
        var city = "本地";
        if (nearest && nearest.areaName && nearest.areaName[0]) {
            city = nearest.areaName[0].value;
        }
        if (nameEl) nameEl.textContent = city;

        // 2. 温度 & 描述
        var temp = current.temp_C;
        var desc = current.weatherDesc && current.weatherDesc[0] ? current.weatherDesc[0].value : "";
        
        // 汉化描述
        var descCN = desc;
        if (desc.includes("Sunny") || desc.includes("Clear")) descCN = "晴";
        else if (desc.includes("Partly cloudy")) descCN = "多云";
        else if (desc.includes("Cloudy") || desc.includes("Overcast")) descCN = "阴";
        else if (desc.includes("Rain")) descCN = "雨";
        else if (desc.includes("Snow")) descCN = "雪";
        else if (desc.includes("Fog") || desc.includes("Mist") || desc.includes("Haze")) descCN = "雾";
        else if (desc.includes("Thunder")) descCN = "雷雨";

        if (tempEl) tempEl.textContent = temp + "°";
        if (descEl) descEl.textContent = descCN;

        // 3. 图标 (使用 Remix Icon class)
        var matchedIcon = "ri-cloudy-line";
        for (var key in iconMap) {
            if (desc.includes(key)) {
                matchedIcon = iconMap[key];
                break;
            }
        }
        if (iconEl) {
           iconEl.className = "weather-icon-big " + matchedIcon;
           // 确保不再设置 textContent 为 emoji
           iconEl.textContent = "";
        }

        // 4. 未来几天温度趋势（使用 Open‑Meteo 提供 7 天预报，高低温双折线）
        if (chartHighLineEl && chartLowLineEl && chartSvgEl && chartLabelsEl) {
          // 抽一个内部方法：给定 daily 数据，直接渲染折线图和上下的文案/图标
          function buildChartFromDaily(daily) {
            if (!daily || !daily.time) return;

            var times = daily.time;
            var maxTemps = daily.temperature_2m_max || [];
            var minTemps = daily.temperature_2m_min || [];
            var codes = daily.weathercode || [];
                var len = Math.min(5, times.length, maxTemps.length, minTemps.length, codes.length);
                if (!len) return;

                var labels = [];
                var weekMap = ["日","一","二","三","四","五","六"];

                var i;
                for (i = 0; i < len; i++) {
                  var dateStr = times[i];
                  var d = new Date(dateStr);
                  var label = "";
                  if (i === 0) label = "今";
                  else if (i === 1) label = "明";
                  else if (!isNaN(d.getTime())) {
                    label = "周" + weekMap[d.getDay()];
                  } else {
                    label = (i + 1) + "天";
                  }
                  labels.push(label);
                }

                // 标题不再展示“未来 N 天”，保持为空即可
                if (chartTitleEl) {
                  chartTitleEl.textContent = "";
                }

                var tMin = Math.min.apply(null, minTemps.slice(0, len));
                var tMax = Math.max.apply(null, maxTemps.slice(0, len));
                if (tMax === tMin) tMax = tMin + 1;

                var highPoints = [];
                var lowPoints = [];
                var dots = chartSvgEl.querySelectorAll(".weather-chart-dot");
                Array.prototype.forEach.call(dots, function (node) {
                  chartSvgEl.removeChild(node);
                });
                // 清空上方/下方的日期、图标、温度
                if (chartLabelsEl) chartLabelsEl.innerHTML = "";
                if (chartIconsHighEl) chartIconsHighEl.innerHTML = "";
                if (chartTempsHighEl) chartTempsHighEl.innerHTML = "";
                if (chartTempsLowEl) chartTempsLowEl.innerHTML = "";
                if (chartIconsLowEl) chartIconsLowEl.innerHTML = "";

                // 把天数同步到 CSS 变量，grid 自动等分
                var rows = [chartLabelsEl, chartIconsHighEl, chartTempsHighEl, chartTempsLowEl, chartIconsLowEl];
                rows.forEach(function (el) {
                  if (el) el.style.setProperty("--weather-days", len);
                });

                // 映射天气代码到图标
                function mapWeatherCodeToIcon(code) {
                  if (code === 0) return "ri-sun-line"; // 晴
                  if (code === 1 || code === 2) return "ri-sun-cloudy-line"; // 少云/局部多云
                  if (code === 3) return "ri-cloudy-line"; // 阴
                  if (code === 45 || code === 48) return "ri-foggy-line"; // 雾
                  if (code === 51 || code === 53 || code === 55) return "ri-drizzle-line"; // 毛毛雨
                  if (code === 61 || code === 63 || code === 65) return "ri-rainy-line"; // 小/中/大雨
                  if (code === 80 || code === 81 || code === 82) return "ri-heavy-showers-line"; // 阵雨
                  if (code === 71 || code === 73 || code === 75 || code === 77) return "ri-snowy-line"; // 雪
                  if (code === 95 || code === 96 || code === 99) return "ri-thunderstorms-line"; // 雷暴
                  return "ri-cloudy-2-line";
                }

                // 先渲染日期 / 图标 / 数字，让它们在 DOM 中占好位置
                for (i = 0; i < len; i++) {
                  // 上方：日期
                  if (chartLabelsEl) {
                    var labelSpan = document.createElement("span");
                    labelSpan.textContent = labels[i];
                    chartLabelsEl.appendChild(labelSpan);
                  }

                  // 最高温天气图示
                  var iconClass = mapWeatherCodeToIcon(codes[i]);
                  if (chartIconsHighEl) {
                    var iconSpanHigh = document.createElement("span");
                    iconSpanHigh.innerHTML = "<i class='" + iconClass + "'></i>";
                    chartIconsHighEl.appendChild(iconSpanHigh);
                  }

                  // 最高温数字
                  if (chartTempsHighEl) {
                    var tempSpanHigh = document.createElement("span");
                    tempSpanHigh.textContent = Math.round(maxTemps[i]) + "°";
                    chartTempsHighEl.appendChild(tempSpanHigh);
                  }

                  // 最低温数字
                  if (chartTempsLowEl) {
                    var tempSpanLow = document.createElement("span");
                    tempSpanLow.textContent = Math.round(minTemps[i]) + "°";
                    chartTempsLowEl.appendChild(tempSpanLow);
                  }

                  // 最低温天气图示
                  if (chartIconsLowEl) {
                    var iconSpanLow = document.createElement("span");
                    iconSpanLow.innerHTML = "<i class='" + iconClass + "'></i>";
                    chartIconsLowEl.appendChild(iconSpanLow);
                  }
                }

                // 1. 先获取 SVG 的真实像素大小
                var svgRect = chartSvgEl.getBoundingClientRect();
                var svgW = svgRect.width || 300; // 兜底宽
                var svgH = svgRect.height || 80; // 兜底高

                // 2. 设置 viewBox 为 1:1 像素映射，防止非等比缩放
                chartSvgEl.setAttribute("viewBox", "0 0 " + svgW + " " + svgH);

                // 3. 计算 5 等分列的像素中心 x
                // 第 i 列 (0-based) 的中心 x = svgW * (i + 0.5) / len
                var topY = 10;
                var bottomY = svgH - 10; // 留点底部边距

                for (i = 0; i < len; i++) {
                  var xVal = len === 1 ? (svgW / 2) : (svgW * (i + 0.5) / len);
                  var normHigh = (maxTemps[i] - tMin) / (tMax - tMin);
                  var normLow = (minTemps[i] - tMin) / (tMax - tMin);
                  
                  // Y 轴映射：温度高 -> y小 (SVG top)
                  var yHigh = bottomY - normHigh * (bottomY - topY);
                  var yLow = bottomY - normLow * (bottomY - topY);

                  highPoints.push(xVal.toFixed(1) + "," + yHigh.toFixed(1));
                  lowPoints.push(xVal.toFixed(1) + "," + yLow.toFixed(1));

                  // 折线上的小圆点（高/低温）
                  var dotHigh = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                  dotHigh.setAttribute("class", "weather-chart-dot");
                  dotHigh.setAttribute("cx", xVal.toFixed(1));
                  dotHigh.setAttribute("cy", yHigh.toFixed(1));
                  dotHigh.setAttribute("r", 3); // 像素级，稍微大一点
                  dotHigh.setAttribute("fill", "#f97316");
                  chartSvgEl.appendChild(dotHigh);

                  var dotLow = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                  dotLow.setAttribute("class", "weather-chart-dot");
                  dotLow.setAttribute("cx", xVal.toFixed(1));
                  dotLow.setAttribute("cy", yLow.toFixed(1));
                  dotLow.setAttribute("r", 2.5); // 像素级
                  dotLow.setAttribute("fill", "#3b82f6");
                  chartSvgEl.appendChild(dotLow);
                }

                chartHighLineEl.setAttribute("points", highPoints.join(" "));
                chartLowLineEl.setAttribute("points", lowPoints.join(" "));

                if (chartAreaEl) {
                  // Area 到底部
                  var areaBottom = svgH; 
                  var area = [];
                  if (highPoints.length) {
                    var first = highPoints[0].split(",");
                    var last = highPoints[highPoints.length - 1].split(",");
                    area.push(first[0] + "," + areaBottom);
                    area = area.concat(highPoints);
                    area.push(last[0] + "," + areaBottom);
                    chartAreaEl.setAttribute("points", area.join(" "));
                  } else {
                    chartAreaEl.setAttribute("points", "");
                  }
                }

                // 行内容已在循环中填充，无需再单独处理
          }

          // 优先使用 fetchWeather 已经拿到并挂在 data 上的 daily_forecast
          if (data.daily_forecast) {
            buildChartFromDaily(data.daily_forecast);
          } else {
            // 兜底：如果没有 daily_forecast（例如旧缓存数据），再按经纬度请求一次
            var lat = null;
            var lon = null;
            if (nearest) {
              // wttr 返回的纬度/经度有时是字符串，有时是 [{ value: "" }]
              if (nearest.latitude) {
                if (typeof nearest.latitude === "string") {
                  lat = parseFloat(nearest.latitude);
                } else if (nearest.latitude[0] && nearest.latitude[0].value) {
                  lat = parseFloat(nearest.latitude[0].value);
                }
              }
              if (nearest.longitude) {
                if (typeof nearest.longitude === "string") {
                  lon = parseFloat(nearest.longitude);
                } else if (nearest.longitude[0] && nearest.longitude[0].value) {
                  lon = parseFloat(nearest.longitude[0].value);
                }
              }
            }

            if (lat && lon) {
              var url =
                "https://api.open-meteo.com/v1/forecast?latitude=" +
                lat +
                "&longitude=" +
                lon +
                "&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto";

              fetch(url)
                .then(function (res) { return res.json(); })
                .then(function (forecast) {
                  if (!forecast || !forecast.daily) return;
                  buildChartFromDaily(forecast.daily);
                })
                .catch(function (err) {
                  console.warn("Open-Meteo forecast error", err);
                });
            }
          }
        }
        
        if (updateTimeEl) {
            var now = new Date();
            var h = now.getHours().toString().padStart(2, '0');
            var m = now.getMinutes().toString().padStart(2, '0');
            updateTimeEl.textContent = h + ":" + m + " 更新";
        }
    }

    var CACHE_KEY = "nav_weather_data";
    var CACHE_TIME_KEY = "nav_weather_time";
    var CACHE_DURATION = 3600 * 1000; // 1 hour

    function fetchWeather() {
      if (updateTimeEl) updateTimeEl.textContent = "更新中...";

      // 将 Open‑Meteo 的 current_weather + daily 数据，转换成 renderWeather 之前习惯的 wttr 结构
      function mapCodeToDesc(code) {
        // 尽量用和 iconMap 一致的英文描述，方便后续复用映射
        if (code === 0) return "Sunny";
        if (code === 1 || code === 2) return "Partly cloudy";
        if (code === 3) return "Cloudy";
        if (code === 45 || code === 48) return "Fog";
        if (code === 51 || code === 53 || code === 55) return "Light rain";
        if (code === 61 || code === 63) return "Rain";
        if (code === 65 || code === 80 || code === 81 || code === 82) return "Heavy rain";
        if (code === 71 || code === 73 || code === 75 || code === 77) return "Snow";
        if (code === 95 || code === 96 || code === 99) return "Thunderstorm";
        return "Cloudy";
      }

      function offline() {
        if (nameEl) nameEl.textContent = "离线";
        if (updateTimeEl) updateTimeEl.textContent = "获取失败";
      }

      function loadByCoords(lat, lon, cityLabel) {
        if (!lat || !lon) {
          offline();
          return;
        }

        var url =
          "https://api.open-meteo.com/v1/forecast?latitude=" +
          lat +
          "&longitude=" +
          lon +
          "&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto";

        fetch(url)
          .then(function (res) { return res.json(); })
          .then(function (om) {
            if (!om || !om.current_weather) {
              offline();
              return;
            }

            var cw = om.current_weather;
            var descEn = mapCodeToDesc(typeof cw.weathercode === "number" ? cw.weathercode : 0);

            // 组装成 renderWeather 习惯使用的 wttr.in 样式结构，
            // 并把 daily 一并挂在 fakeWttr 上，后面画折线图直接复用，不再发第二次请求
            var fakeWttr = {
              current_condition: [
                {
                  temp_C: Math.round(cw.temperature || 0),
                  weatherDesc: [{ value: descEn }]
                }
              ],
              nearest_area: [
                {
                  areaName: [{ value: cityLabel || "本地" }],
                  latitude: String(lat),
                  longitude: String(lon)
                }
              ],
              daily_forecast: om.daily || null
            };

            localStorage.setItem(CACHE_KEY, JSON.stringify(fakeWttr));
            localStorage.setItem(CACHE_TIME_KEY, Date.now());
            renderWeather(fakeWttr);
          })
          .catch(function (err) {
            console.warn("Open-Meteo base fetch failed", err);
            offline();
          });
      }

      function useIpLocation() {
        // 使用 IP 定位获取大致城市 & 经纬度（无需 key 的公共接口）
        fetch("https://ipapi.co/json/")
          .then(function (res) { return res.json(); })
          .then(function (ip) {
            var lat = ip && ip.latitude;
            var lon = ip && ip.longitude;
            var city = (ip && ip.city) || "本地";
            if (!lat || !lon) {
              offline();
              return;
            }
            loadByCoords(lat, lon, city);
          })
          .catch(function (err) {
            console.warn("IP location fetch failed", err);
            offline();
          });
      }

      // 优先尝试浏览器原生定位（如果用户允许），失败再退回 IP 定位
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function (pos) {
            var lat = pos && pos.coords && pos.coords.latitude;
            var lon = pos && pos.coords && pos.coords.longitude;
            // 尝试使用免费的逆地理编码 API 获取城市名
            // 如果失败，则降级使用“当前位置”
            fetch(
              "https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=" +
                lat +
                "&longitude=" +
                lon +
                "&localityLanguage=zh"
            )
              .then(function (res) {
                return res.json();
              })
              .then(function (geo) {
                var city =
                  geo.city ||
                  geo.locality ||
                  geo.principalSubdivision ||
                  "当前位置";
                // 有些返回包含“市”字，有些不包含，可按需处理
                loadByCoords(lat, lon, city);
              })
              .catch(function () {
                loadByCoords(lat, lon, "当前位置");
              });
          },
          function () {
            useIpLocation();
          },
          {
            enableHighAccuracy: false,
            timeout: 5000,
            maximumAge: 10 * 60 * 1000
          }
        );
      } else {
        useIpLocation();
      }
    }

    // Init
    var cachedData = localStorage.getItem(CACHE_KEY);
    var cachedTime = localStorage.getItem(CACHE_TIME_KEY);

    if (cachedData && cachedTime && (Date.now() - cachedTime < CACHE_DURATION)) {
        try {
            renderWeather(JSON.parse(cachedData));
        } catch (e) {
            fetchWeather();
        }
    } else {
        fetchWeather();
    }
  })();

  // 回到顶部按钮
  (function () {
    var btn = document.getElementById("backToTop");
    if (!btn) return;

    function toggle() {
      var feedbackBtn = document.getElementById("feedbackBtn");
      if (window.scrollY > 260) {
        btn.classList.add("is-visible");
        if (feedbackBtn) feedbackBtn.classList.add("move-up");
      } else {
        btn.classList.remove("is-visible");
        if (feedbackBtn) feedbackBtn.classList.remove("move-up");
      }
    }

    window.addEventListener("scroll", toggle);
    toggle();

    btn.addEventListener("click", function () {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  })();

  // 左侧分组点击后滚动到右侧对应分类（不再维护选中状态）
  (function () {
    var groupItems = document.querySelectorAll(".sidebar .side-menu li[data-section-id]");
    if (!groupItems.length) return;

    groupItems.forEach(function (item) {
      item.addEventListener("click", function () {
        var targetId = item.getAttribute("data-section-id");
        if (!targetId) return;
        var target = document.getElementById(targetId);
        if (!target) return;
        var rect = target.getBoundingClientRect();
        var top = rect.top + window.scrollY - 12;
        window.scrollTo({ top: top, behavior: "smooth" });
      });
    });
  })();


  // 访客数据逻辑：从 51.la 隐藏挂件中抓取数据并填入自定义样式
  (function () {
    function syncData() {
        var container = document.getElementById("la_data_container");
        
        if (!container) return;

        // Try to get text even if hidden
        var text = container.textContent || container.innerText || "";
        
        if (!text.trim()) return;
        
        // 解析数字：
        // 顺序通常是：[标题] -> [活跃] -> [今日UV] -> [总PV]
        // 或者 [标题] -> [活跃] -> [今日UV] -> [总UV] (如果display允许)
        // 我们现在使用 display=1,1,1,0,0,0,0,1
        // 1: Title
        // 1: Active (Current Online)
        // 1: Today UV
        // 0: Today PV
        // 0: Yesterday UV
        // 0: Yesterday PV
        // 0: Month PV
        // 1: Total PV (usually, unless Total UV is available)

        // 尝试正则匹配
        var onlineMatch = text.match(/(\d+).*?(?:活跃|在线|Current)/) || text.match(/(?:活跃|在线|Current).*?(\d+)/);
        var todayMatch  = text.match(/(\d+).*?(?:今日|Today)/) || text.match(/(?:今日|Today).*?(\d+)/);
        var totalMatch  = text.match(/(\d+).*?(?:总|Total)/) || text.match(/(?:总|Total).*?(\d+)/);

        // 如果正则失败，尝试纯数字序列
        // 预期顺序：[Active] ... [Today] ... [Total]
        // 因为 Title 是文本
        var nums = text.match(/\d+/g);
        
        var onlineVal = "1";
        var todayVal = "--";
        var totalVal = "--";

        if (nums && nums.length >= 3) {
             // 假设顺序：Active, Today, Total
             onlineVal = nums[0];
             todayVal = nums[1];
             totalVal = nums[2];
        } else {
             // Fallback to regex results
             if (onlineMatch) onlineVal = onlineMatch[1];
             if (todayMatch) todayVal = todayMatch[1];
             if (totalMatch) totalVal = totalMatch[1];
        }

        // 数据清洗与逻辑校验
        var tDay = parseInt(todayVal, 10);
        var tTot = parseInt(totalVal, 10);

        // 逻辑：累计访问至少等于今日访问
        if (!isNaN(tDay)) {
            if (isNaN(tTot) || tTot < tDay) {
                tTot = tDay; 
                totalVal = tTot.toString();
            }
        }
        
        // 异常值过滤 (ID等)
        if (parseInt(totalVal) > 100000000) totalVal = "1";

        // 更新 UI
        var elTotal = document.getElementById("custom_total");
        var elToday = document.getElementById("custom_today");
        var elOnline = document.getElementById("custom_online");

        if (elTotal) elTotal.textContent = totalVal;
        if (elToday) elToday.textContent = todayVal;
        if (elOnline) elOnline.textContent = onlineVal;
    }

    // 轮询检查数据是否加载完成
    setInterval(syncData, 1000);
  })();


</script>
<script>


  // 轮播图逻辑
  (function() {
    var bannerWrapper = document.getElementById("bannerWrapper");
    var indicatorsEl = document.getElementById("bannerIndicators");
    var loadingEl = bannerWrapper ? bannerWrapper.querySelector(".banner-loading") : null;
    
    if (!bannerWrapper) return;

    var slidesData = [];
    var currentIndex = 0;
    var slideInterval = null;

    // 多源 RSS 配置 (全中文优质 AI 资讯源)
    // 使用 rss2json API (free tier limits: 1h cache)
    var feedSources = [
      { url: "https://www.jiqizhixin.com/rss", name: "机器之心" },
      { url: "https://www.qbitai.com/feed", name: "量子位" },
      { url: "https://36kr.com/feed/tag/AI", name: "36氪AI" }, // 更精准的分类
      { url: "https://www.aibase.com/feed", name: "AI基地" }, 
      { url: "https://hub.baai.ac.cn/rss", name: "智源社区" },
      { url: "https://www.leiphone.com/feed", name: "雷峰网" }, // 补充
      { url: "https://cn.technode.com/feed", name: "动点科技" }  // 补充
    ];

    // Fallback data
    var fallbackData = [
      {
        title: "OpenAI 发布 GPT-4o 模型，多模态能力大幅提升",
        link: "https://openai.com/index/hello-gpt-4o/",
        image: "https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&q=80&w=1000",
        source: "OpenAI"
      },
      {
        title: "Google I/O 2024：Gemini 全面整合进 Android 系统",
        link: "https://blog.google/products/android/android-ai-gemini-io-2024/",
        image: "https://images.unsplash.com/photo-1599507593499-a3f7d7d97667?auto=format&fit=crop&q=80&w=1000",
        source: "Google"
      },
      {
        title: "Apple 推出 Apple Intelligence，重新定义个人智能系统",
        link: "https://www.apple.com/apple-intelligence/",
        image: "https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?auto=format&fit=crop&q=80&w=1000",
        source: "Apple"
      },
      {
        title: "Anthropic 发布 Claude 3.5 Sonnet，编码能力超越 GPT-4o",
        link: "https://www.anthropic.com/news/claude-3-5-sonnet",
        image: "https://images.unsplash.com/photo-1620712943543-bcc4688e7485?auto=format&fit=crop&q=80&w=1000",
        source: "Anthropic"
      },
      {
        title: "Midjourney v6.1 版本更新，图像细节与连贯性增强",
        link: "https://www.midjourney.com",
        image: "https://images.unsplash.com/photo-1542831371-29b0f74f9713?auto=format&fit=crop&q=80&w=1000",
        source: "Midjourney"
      }
    ];

    // 辅助：提取图片
    function extractImage(item) {
        // 1. Try enclosure
        if (item.enclosure && item.enclosure.link && item.enclosure.type && item.enclosure.type.indexOf('image') !== -1) {
            return item.enclosure.link;
        }
        // 2. Try media:content (rss2json sometimes maps this to thumbnail or enclosure)
        if (item.thumbnail) return item.thumbnail;
        
        // 3. Regex in description/content
        var html = (item.description || "") + (item.content || "");
        var imgRegex = /<img[^>]+src="([^">]+)"/i;
        var match = html.match(imgRegex);
        if (match && match[1]) return match[1];

        return null;
    }

    // 辅助：获取 AI 风格随机图兜底
    function getRandomFallbackImage(index) {
        var images = [
            "https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&q=80&w=800",
            "https://images.unsplash.com/photo-1620712943543-bcc4688e7485?auto=format&fit=crop&q=80&w=800",
            "https://images.unsplash.com/photo-1599507593499-a3f7d7d97667?auto=format&fit=crop&q=80&w=800",
            "https://images.unsplash.com/photo-1617791160505-6f00504e3519?auto=format&fit=crop&q=80&w=800",
            "https://images.unsplash.com/photo-1531297461137-3635ebef57a6?auto=format&fit=crop&q=80&w=800"
        ];
        return images[index % images.length];
    }

    // 辅助：根据标题生成相关图片 (Keyword Matching + Deterministic Hash)
    function getRelevantImage(title) {
        if (!title) return getRandomFallbackImage(0);
        
        var t = title.toLowerCase();
        
        // 1. 关键词匹配
        if (t.includes("apple") || t.includes("iphone") || t.includes("mac") || t.includes("ios")) 
            return "https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?w=800&q=80";
        if (t.includes("google") || t.includes("gemini") || t.includes("android") || t.includes("pixel")) 
            return "https://images.unsplash.com/photo-1573804633927-bfcbcd909acd?w=800&q=80";
        if (t.includes("openai") || t.includes("gpt") || t.includes("chatgpt")) 
            return "https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80";
        if (t.includes("microsoft") || t.includes("copilot") || t.includes("bing")) 
            return "https://images.unsplash.com/photo-1633419461186-7d75076e474b?w=800&q=80";
        if (t.includes("tesla") || t.includes("robot") || t.includes("musk")) 
            return "https://images.unsplash.com/photo-1485827404703-89b55fcc595e?w=800&q=80";
        if (t.includes("code") || t.includes("python") || t.includes("github") || t.includes("dev")) 
            return "https://images.unsplash.com/photo-1526374965328-7f61d4dc18c5?w=800&q=80";
        if (t.includes("image") || t.includes("video") || t.includes("midjourney") || t.includes("sora")) 
            return "https://images.unsplash.com/photo-1535378437327-525e99493c56?w=800&q=80";
        if (t.includes("chip") || t.includes("nvidia") || t.includes("hardware")) 
            return "https://images.unsplash.com/photo-1555664424-778a1e5e1b48?w=800&q=80";

        // 2. 哈希回退
        var hash = 0;
        for (var i = 0; i < title.length; i++) {
            hash = title.charCodeAt(i) + ((hash << 5) - hash);
        }
        var index = Math.abs(hash);
        
        var pool = [
            "https://images.unsplash.com/photo-1620712943543-bcc4688e7485?w=800&q=80", // Cyberpunk
            "https://images.unsplash.com/photo-1531297461137-3635ebef57a6?w=800&q=80", // Dark Tech
            "https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&q=80", // Network
            "https://images.unsplash.com/photo-1518770660439-4636190af475?w=800&q=80", // Chip
            "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=800&q=80", // City
            "https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=800&q=80", // Work
            "https://images.unsplash.com/photo-1504384308090-c54be3855462?w=800&q=80", // Light
            "https://images.unsplash.com/photo-1620825937374-87fc7d6bddc2?w=800&q=80"  // Abstract
        ];
        
        return pool[index % pool.length];
    }

    function fetchNews() {
        var promises = feedSources.map(function(source) {
            // 添加 t=Date.now() 防止浏览器缓存请求
            // 并添加 api_key 参数（如果 rss2json 有提供）以绕过服务器端缓存，这里仅使用时间戳
            var apiUrl = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(source.url) + "&t=" + Date.now();
            return fetch(apiUrl)
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    if (data.status === "ok" && data.items) {
                        return data.items.map(function(item) {
                            return {
                                title: item.title,
                                link: item.link,
                                pubDate: new Date(item.pubDate), // rss2json returns standardized format
                                image: extractImage(item),
                                source: source.name
                            };
                        });
                    }
                    return [];
                })
                .catch(function(e) { 
                    console.warn("Feed fetch failed: " + source.name, e);
                    return []; 
                });
        });

        Promise.all(promises).then(function(results) {
            // Flatten arrays
            var allNews = [].concat.apply([], results);
            
            // Filter out items without images if possible, or keep them with fallbacks
            // Sort by date descending
            allNews.sort(function(a, b) { return b.pubDate - a.pubDate; });

            // Take top 5
            var finalNews = allNews.slice(0, 5);

            // Process images (add fallback if null)
            finalNews = finalNews.map(function(item, idx) {
                // 如果 image 字段为空，或者虽然有值但是加载失败（这里只能做静态判断，更复杂的用 onerror）
                // 我们这里做更强力的兜底：只要没有明确的有效 URL，就上智能配图
                if (!item.image || item.image.length < 10) {
                    item.image = getRelevantImage(item.title);
                }
                return item;
            });

            if (finalNews.length > 0) {
                initSlider(finalNews);
            } else {
                initSlider(fallbackData);
            }
        });
    }

    function initSlider(data) {
      slidesData = data;
      if (loadingEl) loadingEl.style.display = "none";
      
      bannerWrapper.innerHTML = ""; // Clear loading
      
      // Re-create indicators wrapper if cleared
      // But wait, user provided HTML structure had indicators separate from slides?
      // No, they are inside bannerWrapper.
      // So we must rebuild everything inside bannerWrapper.
      
      // 1. Slides
      data.forEach(function(item, index) {
        var slide = document.createElement("div");
        slide.className = "banner-slide" + (index === 0 ? " active" : "");
        
        // 尝试加载图片，如果失败则使用兜底背景
        // 我们不直接设 backgroundImage，因为那样没法监听 error
        // 这里用个 trick：设为 backgroundImage，同时用 Image 对象预加载检测
        var imgObj = new Image();
        imgObj.src = item.image;
        
        // 默认先给一个好看的渐变背景，防止加载期间或失败时空白
        slide.style.background = "linear-gradient(135deg, #cbd5e1 0%, #f1f5f9 100%)"; 
        
        imgObj.onload = function() {
            // 防御性检查：如果图片太小（可能是追踪像素），强制使用兜底
            if (this.width < 150 || this.height < 100) {
                console.warn("Image too small (likely tracking pixel):", item.image);
                var fallbackUrl = getRelevantImage(item.title);
                if (fallbackUrl !== item.image) {
                    slide.style.backgroundImage = "url('" + fallbackUrl + "')";
                }
            } else {
                slide.style.backgroundImage = "url('" + item.image + "')";
            }
        };
        // 如果图片挂了，再次尝试用随机图兜底
        imgObj.onerror = function() {
            console.warn("Image failed to load:", item.image);
            var fallbackUrl = getRelevantImage(item.title);
            // 避免死循环：如果 fallback 也和当前一样就不换了
            if (fallbackUrl !== item.image) {
                slide.style.backgroundImage = "url('" + fallbackUrl + "')";
            }
        };
        
        // 初始设置（如果浏览器缓存里有，可能 onload 不触发，或者闪烁）
        // 最稳妥的方式：还是直接设，onerror 交给 JS 动态修补太慢，不如 CSS 渐变兜底
        // 这里我们采用：先设 URL，如果图挂了，它就是透明的（显示底色）
        slide.style.backgroundImage = "url('" + item.image + "')";
        slide.onclick = function() {
           window.open(item.link, "_blank");
        };
        
        var content = document.createElement("div");
        content.className = "banner-content";
        
        var tag = document.createElement("span");
        tag.className = "banner-tag";
        tag.textContent = item.source || "AI News";
        
        var title = document.createElement("h3");
        title.className = "banner-title";
        title.textContent = item.title;
        
        content.appendChild(tag);
        content.appendChild(title);
        slide.appendChild(content);
        
        bannerWrapper.appendChild(slide);
      });

      // 2. Indicators
      var indContainer = document.createElement("div");
      indContainer.className = "banner-indicators";
      indicatorsEl = indContainer; // Update ref

      data.forEach(function(_, index) {
        var dot = document.createElement("div");
        dot.className = "banner-dot" + (index === 0 ? " active" : "");
        dot.onclick = function(e) {
          e.stopPropagation();
          goToSlide(index);
        };
        indContainer.appendChild(dot);
      });
      bannerWrapper.appendChild(indContainer);

      startAutoPlay();
    }

    function goToSlide(index) {
      var slides = bannerWrapper.querySelectorAll(".banner-slide");
      var dots = indicatorsEl ? indicatorsEl.querySelectorAll(".banner-dot") : [];
      
      if (index >= slides.length) index = 0;
      if (index < 0) index = slides.length - 1;

      slides.forEach(function(el) { el.classList.remove("active"); });
      dots.forEach(function(el) { el.classList.remove("active"); });

      if (slides[index]) slides[index].classList.add("active");
      if (dots[index]) dots[index].classList.add("active");
      
      currentIndex = index;
      resetAutoPlay();
    }

    function nextSlide() {
      goToSlide(currentIndex + 1);
    }

    function startAutoPlay() {
      if (slideInterval) clearInterval(slideInterval);
      slideInterval = setInterval(nextSlide, 5000);
    }

    function resetAutoPlay() {
      clearInterval(slideInterval);
      slideInterval = setInterval(nextSlide, 5000);
    }

    // Start
    fetchNews();
  })();

  // 权限控制：仅当 URL 包含 ?admin=1 时显示配置按钮
  (function() {
    var urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('admin')) {
      var footer = document.getElementById('sideFooter');
      if (footer) {
        footer.style.display = 'flex';
      }
    }
  })();
</script>

<div class="feedback-btn" id="feedbackBtn" title="问题反馈">
  <i class="ri-feedback-line"></i>
</div>

<div id="feedbackModal" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-header">
      <h3>问题反馈</h3>
      <i class="ri-close-line modal-close" id="feedbackModalClose"></i>
    </div>
    <div class="modal-body">
      <div class="modal-input-group">
        <label>反馈内容 <span style="color:red">*</span></label>
        <textarea id="feedbackContent" class="modal-input" placeholder="请描述您遇到的问题或建议..." style="height: 120px; resize: none;" maxlength="200"></textarea>
      </div>
      <div class="modal-input-group">
        <label>联系方式 (选填)</label>
        <input id="feedbackContact" class="modal-input" placeholder="邮箱或微信号，方便我们联系您" />
      </div>
    </div>
    <div class="modal-footer">
      <button class="modal-btn cancel" id="feedbackCancelBtn">取消</button>
      <button class="modal-btn confirm" id="feedbackSubmitBtn">提交反馈</button>
    </div>
  </div>
</div>

<!-- Admin Feedback List Modal -->
<div id="adminFeedbackModal" class="modal-overlay">
  <div class="modal-box" style="max-width: 600px; width: 90%;">
    <div class="modal-header">
      <h3>反馈列表</h3>
      <i class="ri-close-line modal-close" id="adminFeedbackClose"></i>
    </div>
    <div class="modal-body" style="max-height: 500px; padding: 0; overflow-y: hidden; display: flex; flex-direction: column;">
      <div id="feedbackListContainer" class="feedback-list" style="flex: 1; min-height: 200px; overflow-y: auto; padding: 0; overscroll-behavior: contain;">
        <!-- List items will be injected here -->
      </div>
    </div>
    <div class="modal-footer" style="justify-content: flex-end; align-items: center; padding-top: 12px; padding-bottom: 12px;">
      <!-- Pagination Controls Moved to Footer (Right Aligned) -->
      <div class="pagination-controls" style="margin: 0; border: none; padding: 0; display: flex; gap: 12px; justify-content: flex-end; width: auto;">
         <select id="pageSizeSelect" class="page-size-select">
           <option value="10">10 条/页</option>
           <option value="20" selected>20 条/页</option>
           <option value="50">50 条/页</option>
           <option value="100">100 条/页</option>
         </select>
         <div class="pagination-btns">
            <button id="prevPageBtn" class="page-btn">上一页</button>
            <span id="pageInfo" class="page-info">1 / 1</span>
            <button id="nextPageBtn" class="page-btn">下一页</button>
         </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Feedback Button Style */
.feedback-btn {
  position: fixed;
  right: 22px;
  bottom: 26px; /* Default position (same as back-to-top) */
  width: 40px;
  height: 40px;
  border-radius: 999px;
  background: #ffffff;
  color: #64748b;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  z-index: 50;
  transition: all 0.3s;
  border: 1px solid #e2e8f0;
}
.feedback-btn.move-up {
  bottom: 80px; /* Move up when back-to-top appears */
}
.feedback-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.15);
  color: #2563eb;
  border-color: #cbd5e1;
}

/* Feedback List Style */
.feedback-item {
  padding: 16px 24px;
  border-bottom: 1px solid #f1f5f9;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.feedback-item:last-child { border-bottom: none; }
.feedback-meta {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: #94a3b8;
}
.feedback-text {
  font-size: 14px;
  color: #334155;
  line-height: 1.5;
}
.feedback-contact {
  font-size: 12px;
  color: #2563eb;
  background: #eff6ff;
  padding: 2px 6px;
  border-radius: 4px;
  align-self: flex-start;
}

/* Admin Pagination */
.pagination-controls {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 0 0;
  border-top: 1px solid #f1f5f9;
  margin-top: 10px;
}
.page-size-select {
  padding: 4px 8px;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 12px;
  color: #64748b;
  outline: none;
}
.pagination-btns {
  display: flex;
  gap: 8px;
  align-items: center;
}
.page-btn {
  padding: 4px 10px;
  border: 1px solid #e2e8f0;
  background: #fff;
  border-radius: 6px;
  font-size: 12px;
  cursor: pointer;
  color: #64748b;
}
.page-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
.page-btn:hover:not(:disabled) {
  background: #f8fafc;
  color: #2563eb;
  border-color: #cbd5e1;
}
.page-info {
  font-size: 12px;
  color: #94a3b8;
}
</style>

<!-- 51.la 统计脚本 (用于收集数据) -->
  <script charset="UTF-8" id="LA_COLLECT" src="https://sdk.51.la/js-sdk-pro.min.js"></script>
  <script>
    try {
      LA.init({id:"3OBuXueXb41ODfzv",ck:"3OBuXueXb41ODfzv"});
    } catch (e) {
      console.warn("LA init failed", e);
    }
  </script>

<script>
  // Feedback Logic & Pagination (Moved to end)
  (function() {
      var FEEDBACK_KEY = "site_feedback_data";
      
      // Pagination State
      var currentPage = 1;
      var pageSize = 20;
      var allFeedback = [];

      // UI Refs
      var btn = document.getElementById("feedbackBtn");
      var modal = document.getElementById("feedbackModal");
      var close = document.getElementById("feedbackModalClose");
      var cancel = document.getElementById("feedbackCancelBtn");
      var submit = document.getElementById("feedbackSubmitBtn");
      var contentInput = document.getElementById("feedbackContent");
      var contactInput = document.getElementById("feedbackContact");

      // Open/Close User Modal
      if(btn) btn.onclick = function() { modal.classList.add("is-visible"); };
      function closeModal() { 
          modal.classList.remove("is-visible"); 
          setTimeout(function() {
            if(contentInput) contentInput.value = "";
            if(contactInput) contactInput.value = "";
          }, 200);
      }
      if(close) close.onclick = closeModal;
      if(cancel) cancel.onclick = closeModal;

      // Submit
      if(submit) submit.onclick = function() {
          var content = contentInput.value.trim();
          if (!content) { alert("请输入反馈内容"); return; }
          
          var newFeedback = {
              id: Date.now(),
              content: content,
              contact: contactInput.value.trim() || "无联系方式",
              time: new Date().toLocaleString()
          };
          
          var list = JSON.parse(localStorage.getItem(FEEDBACK_KEY) || "[]");
          list.unshift(newFeedback);
          localStorage.setItem(FEEDBACK_KEY, JSON.stringify(list));
          
          alert("反馈提交成功！");
          closeModal();
          // Refresh admin view if open
          if (document.getElementById("adminFeedbackModal").classList.contains("is-visible")) {
              loadFeedbackData();
              renderFeedbackList();
          }
      };

      // Admin Logic
      var adminModal = document.getElementById("adminFeedbackModal");
      var listContainer = document.getElementById("feedbackListContainer");
      var adminClose = document.getElementById("adminFeedbackClose");
      // var adminConfirm = document.getElementById("adminFeedbackConfirmBtn"); // Removed
      
      // Pagination UI Refs
      var pageSizeSelect = document.getElementById("pageSizeSelect");
      var prevBtn = document.getElementById("prevPageBtn");
      var nextBtn = document.getElementById("nextPageBtn");
      var pageInfo = document.getElementById("pageInfo");

      function loadFeedbackData() {
          allFeedback = JSON.parse(localStorage.getItem(FEEDBACK_KEY) || "[]");
      }

      function renderFeedbackList() {
          listContainer.innerHTML = "";
          
          if (allFeedback.length === 0) {
              listContainer.innerHTML = "<div style='padding:20px;text-align:center;color:#94a3b8;'>暂无反馈</div>";
              pageInfo.textContent = "0 / 0";
              if(prevBtn) prevBtn.disabled = true;
              if(nextBtn) nextBtn.disabled = true;
              return;
          }

          var totalPages = Math.ceil(allFeedback.length / pageSize);
          if (currentPage > totalPages) currentPage = totalPages;
          if (currentPage < 1) currentPage = 1;

          var start = (currentPage - 1) * pageSize;
          var end = start + pageSize;
          var pageItems = allFeedback.slice(start, end);

          pageItems.forEach(function(item) {
              var itemEl = document.createElement("div");
              itemEl.className = "feedback-item";
              itemEl.innerHTML = 
                  '<div class="feedback-meta"><span>' + item.time + '</span></div>' +
                  '<div class="feedback-text">' + item.content + '</div>' +
                  (item.contact ? '<div class="feedback-contact">' + item.contact + '</div>' : '');
              listContainer.appendChild(itemEl);
          });

          // Update Controls
          if(pageInfo) pageInfo.textContent = currentPage + " / " + totalPages;
          if(prevBtn) prevBtn.disabled = currentPage === 1;
          if(nextBtn) nextBtn.disabled = currentPage === totalPages;
      }

      window.openAdminFeedback = function() {
          loadFeedbackData();
          currentPage = 1; // Reset to first page
          renderFeedbackList();
          adminModal.classList.add("is-visible");
      };
      
      function closeAdmin() { adminModal.classList.remove("is-visible"); }
      if(adminClose) adminClose.onclick = closeAdmin;
      // if(adminConfirm) adminConfirm.onclick = closeAdmin; // Removed button

      // Pagination Events
      if(pageSizeSelect) {
          pageSizeSelect.onchange = function() {
              pageSize = parseInt(this.value);
              currentPage = 1;
              renderFeedbackList();
          };
      }
      if(prevBtn) {
          prevBtn.onclick = function() {
              if (currentPage > 1) {
                  currentPage--;
                  renderFeedbackList();
              }
          };
      }
      if(nextBtn) {
          nextBtn.onclick = function() {
              var totalPages = Math.ceil(allFeedback.length / pageSize);
              if (currentPage < totalPages) {
                  currentPage++;
                  renderFeedbackList();
              }
          };
      }

  })();
</script>

<script>
(function() {
    // 自动缩放逻辑：确保在小屏幕（如笔记本）上按比例缩放，避免元素挤压
    function adjustZoom() {
       var width = window.innerWidth;
       // 设定基准宽度 1600px，低于此宽度开始等比缩小
       var baseWidth = 1600; 
       
       // 仅在宽度介于 768px (平板/手机分界) 和 baseWidth 之间时应用缩放
       if (width < baseWidth && width > 768) {
           var scale = width / baseWidth;
           document.body.style.zoom = scale;
           // 补偿高度：因为 zoom 也会缩放视口单位 100vh，导致高度不够
           // 我们需要反向放大以填满屏幕
           var compensatedHeight = 100 / scale;
           var compVal = compensatedHeight + 'vh';
           document.querySelector('.layout').style.minHeight = compVal;
           document.querySelector('.sidebar').style.height = compVal;
       } else {
           // 恢复默认
           document.body.style.zoom = 1;
           document.querySelector('.layout').style.minHeight = '100vh';
           document.querySelector('.sidebar').style.height = '100vh';
       }
    }

    window.addEventListener('resize', adjustZoom);
    // 立即执行一次
    adjustZoom();
    // 防止 DOM 加载延迟
    window.addEventListener('DOMContentLoaded', adjustZoom);
})();
</script>
</body>
</html>



